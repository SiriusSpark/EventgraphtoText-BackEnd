"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[57],{2549:function(e,t,n){n.d(t,{HW:function(){return i},TK:function(){return l},f3:function(){return u},iD:function(){return a},kz:function(){return o},ri:function(){return s},xG:function(){return c}});var r=n(5720);function a(e){return(0,r.A)({url:"/api/users/login",method:"post",data:e})}function o(e){return(0,r.A)({url:"/api/users/register",method:"post",data:e})}function i(){return(0,r.A)({url:"/api/users/me",method:"get"})}function s(){return(0,r.A)({url:"/api/users/logout",method:"post"})}function l(e,t){return(0,r.A)({url:`/api/users/${e}`,method:"put",data:t})}function u(e,t){return(0,r.A)({url:`/api/users/${e}/password`,method:"put",data:{old_password:t.oldPassword,new_password:t.newPassword}})}function c(e,t){const n=new FormData;return n.append("file",t),(0,r.A)({url:`/api/users/${e}/avatar`,method:"put",data:n,headers:{"Content-Type":"multipart/form-data"}})}},3281:function(e,t,n){n.d(t,{A:function(){return L}});var r=n(1387),a=n(3603),o=(n(4114),n(6768)),i=n(4232);const s={class:"app-wrapper"},l={class:"main-container"},u={class:"navbar"},c={class:"right-menu"},p={class:"avatar-wrapper"},d={class:"user-name"},h={class:"app-main",ref:"appMainRef"};function g(e,t,n,r,a,g){const f=(0,o.g2)("House"),m=(0,o.g2)("el-icon"),v=(0,o.g2)("el-menu-item"),k=(0,o.g2)("Share"),b=(0,o.g2)("el-sub-menu"),x=(0,o.g2)("Document"),y=(0,o.g2)("Edit"),A=(0,o.g2)("User"),E=(0,o.g2)("el-menu"),_=(0,o.g2)("el-avatar"),F=(0,o.g2)("CaretBottom"),w=(0,o.g2)("el-dropdown-item"),L=(0,o.g2)("el-dropdown-menu"),R=(0,o.g2)("el-dropdown"),$=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",{class:"sidebar-container",ref:"sidebarRef",onWheel:t[0]||(t[0]=(...e)=>r.handleSidebarScroll&&r.handleSidebarScroll(...e))},[t[18]||(t[18]=(0,o.Lk)("div",{class:"logo-container"},[(0,o.Lk)("span",{class:"eventgraph-logo"},"EventGraph")],-1)),(0,o.bF)(E,{"default-active":r.activeMenu,"background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF",mode:"vertical","unique-opened":!0,router:!0,ref:"menuRef"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{index:"/home"},{default:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(f)])),_:1}),t[3]||(t[3]=(0,o.Lk)("span",null,"仪表盘",-1))])),_:1}),(0,o.bF)(b,{index:"/event-graph"},{title:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(k)])),_:1}),t[4]||(t[4]=(0,o.Lk)("span",null,"事件图",-1))])),default:(0,o.k6)((()=>[(0,o.bF)(v,{index:"/event-graph/list"},{default:(0,o.k6)((()=>t[5]||(t[5]=[(0,o.Lk)("span",null,"事件图列表",-1)]))),_:1}),(0,o.bF)(v,{index:"/event-graph/detail",onClick:r.goToFirstEventGraphEdit},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.Lk)("span",null,"事件图详情",-1)]))),_:1},8,["onClick"]),(0,o.bF)(v,{index:"/event-graph/visualize",onClick:r.goToFirstEventGraphVisualize},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.Lk)("span",null,"事件图可视化",-1)]))),_:1},8,["onClick"])])),_:1}),(0,o.bF)(b,{index:"/text-generation"},{title:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(x)])),_:1}),t[8]||(t[8]=(0,o.Lk)("span",null,"文本生成",-1))])),default:(0,o.k6)((()=>[(0,o.bF)(v,{index:"/text-generation/create",onClick:r.goToFirstEventGraphGeneration},{default:(0,o.k6)((()=>t[9]||(t[9]=[(0,o.Lk)("span",null,"生成新文本",-1)]))),_:1},8,["onClick"]),(0,o.bF)(v,{index:"/text-generation/records",onClick:r.goToFirstEventGraphRecords},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.Lk)("span",null,"生成记录",-1)]))),_:1},8,["onClick"]),(0,o.bF)(v,{index:"/text-generation/list"},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.Lk)("span",null,"全部记录",-1)]))),_:1})])),_:1}),(0,o.bF)(b,{index:"/text-style"},{title:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(y)])),_:1}),t[12]||(t[12]=(0,o.Lk)("span",null,"文本风格",-1))])),default:(0,o.k6)((()=>[(0,o.bF)(v,{index:"/text-style/list"},{default:(0,o.k6)((()=>t[13]||(t[13]=[(0,o.Lk)("span",null,"风格列表",-1)]))),_:1}),(0,o.bF)(v,{index:"/text-style/create"},{default:(0,o.k6)((()=>t[14]||(t[14]=[(0,o.Lk)("span",null,"创建风格",-1)]))),_:1})])),_:1}),(0,o.bF)(b,{index:"/user"},{title:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(A)])),_:1}),t[15]||(t[15]=(0,o.Lk)("span",null,"用户信息",-1))])),default:(0,o.k6)((()=>[(0,o.bF)(v,{index:"/user/profile"},{default:(0,o.k6)((()=>t[16]||(t[16]=[(0,o.Lk)("span",null,"个人资料",-1)]))),_:1}),(0,o.bF)(v,{index:"/user/change-password"},{default:(0,o.k6)((()=>t[17]||(t[17]=[(0,o.Lk)("span",null,"修改密码",-1)]))),_:1})])),_:1})])),_:1},8,["default-active"])],544),(0,o.Lk)("div",l,[(0,o.Lk)("div",u,[(0,o.Lk)("div",c,[(0,o.bF)(R,{trigger:"click"},{dropdown:(0,o.k6)((()=>[(0,o.bF)(L,null,{default:(0,o.k6)((()=>[(0,o.bF)(w,{onClick:t[1]||(t[1]=e=>r.router.push("/user/profile"))},{default:(0,o.k6)((()=>t[19]||(t[19]=[(0,o.eW)("个人资料")]))),_:1}),(0,o.bF)(w,{onClick:t[2]||(t[2]=e=>r.router.push("/user/change-password"))},{default:(0,o.k6)((()=>t[20]||(t[20]=[(0,o.eW)("修改密码")]))),_:1}),(0,o.bF)(w,{onClick:r.handleLogout},{default:(0,o.k6)((()=>t[21]||(t[21]=[(0,o.eW)("退出登录")]))),_:1},8,["onClick"])])),_:1})])),default:(0,o.k6)((()=>[(0,o.Lk)("div",p,[(0,o.bF)(_,{size:40,src:r.userAvatar,onError:r.handleAvatarError},{default:(0,o.k6)((()=>[(0,o.eW)((0,i.v_)(r.userInitials),1)])),_:1},8,["src","onError"]),(0,o.Lk)("span",d,(0,i.v_)(r.userName),1),(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(F)])),_:1})])])),_:1})])]),(0,o.Lk)("div",h,[(0,o.bF)($)],512)])])}var f=n(144),m=n(4249),v=n(7477),k=n(5720),b=n(8270),x=n(1219),y={name:"Layout",components:{House:v.tTi,Share:v.SYj,Edit:v.ffu,Document:v.yoT,CaretBottom:v.BHL,User:v.KJW},setup(){const e=(0,m.Pj)(),t=(0,r.rd)(),n=(0,r.lq)(),a=(0,f.KR)(null),i=(0,f.KR)(null),s=(0,f.KR)(null),l=(0,f.KR)(!1),u=(0,f.KR)(null),c="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",p=["/home","/event-graph/list","/event-graph/detail","/event-graph/visualize","/text-generation/create","/text-generation/records","/text-generation/list","/text-style/list","/text-style/create","/user/profile","/user/change-password"],d=(e,t="next")=>{let r=e,a=null;if(e.startsWith("/event-graph/detail/"))r="/event-graph/detail",a=e.split("/").pop();else if(e.startsWith("/event-graph/visualize/"))r="/event-graph/visualize",a=e.split("/").pop();else if(e.startsWith("/text-generation/records/"))r="/text-generation/records",a=e.split("/").pop();else if(e.includes("eventGraphId=")){r=e.split("?")[0];const t=e.match(/eventGraphId=([^&]+)/);t&&t[1]&&(a=t[1])}!a&&n.params.id&&(a=n.params.id),!a&&n.query.eventGraphId&&(a=n.query.eventGraphId),console.log("当前路径:",e,"标准化路径:",r,"事件图ID:",a);const o=p.findIndex((e=>r===e||r.startsWith(e+"/")));if(console.log("在导航列表中的索引:",o),-1===o)return null;let i;if("next"===t){if(i=o+1,i>=p.length)return null}else if(i=o-1,i<0)return null;const s=p[i];if(console.log("下一个路径:",s,"当前事件图ID:",a),a){if("/event-graph/detail"===s)return`/event-graph/detail/${a}`;if("/event-graph/visualize"===s)return`/event-graph/visualize/${a}`;if("/text-generation/create"===s)return`/text-generation/create?eventGraphId=${a}`;if("/text-generation/records"===s)return`/text-generation/records/${a}`}return"/event-graph/detail"===s?(w(),null):"/event-graph/visualize"===s?(L(),null):"/text-generation/create"===s?(R(),null):"/text-generation/records"===s?($(),null):s},h=e=>{l.value||(e.preventDefault(),u.value&&clearTimeout(u.value),u.value=setTimeout((()=>{const r=e.deltaY>0?"next":"prev",a=n.fullPath,o=d(a,r);o&&(console.log(`侧边栏滚动到${"next"===r?"下":"上"}一页: ${o}`),l.value=!0,t.push(o).then((()=>{setTimeout((()=>{l.value=!1}),300)})))}),50))};(0,o.wB)((()=>n.path),(e=>{(0,o.dY)((()=>{const e=i.value;e&&(e.scrollTop=0)}))}));const g=(0,o.EW)((()=>e.state.user.nickname||e.state.user.username||"用户")),v=e=>{if(console.log("头像URL处理函数:",e),!e)return console.log(" - 无URL，使用默认头像"),c;if(e.includes("/uploads/avatars/")){const t=e.match(/\/uploads\/avatars\/([^/]+)$/);if(t&&t[1]){const e=t[1],n=`/uploads/avatars/${e}`;return console.log(" - 使用相对路径:",n),n}}const t=(0,k.o)(e);return console.log(" - 修复后的URL:",t),t.startsWith("http"),t},y=(0,o.EW)((()=>v(e.state.user.avatar_url))),A=(0,o.EW)((()=>{const e=g.value;return e?e.charAt(0).toUpperCase():"U"}));(0,o.sV)((()=>{console.log("Layout组件已挂载，开始获取用户信息"),e.dispatch("getUserInfo").then((()=>{console.log("用户信息获取成功，更新后的用户数据:",e.state.user)})).catch((e=>{console.error("获取用户信息失败:",e)}));const t=console.error;return console.error=function(e,...n){if(!e||"string"!==typeof e||!e.includes("ResizeObserver loop completed with undelivered notifications"))return t.apply(console,[e,...n])},()=>{u.value&&clearTimeout(u.value)}}));const E=(0,o.EW)((()=>{const{path:e,meta:t}=n;return console.log("当前路径:",e,"元信息:",t),t.activeMenu?(console.log("使用meta中定义的activeMenu:",t.activeMenu),t.activeMenu):e.startsWith("/text-generation/records/")?"/text-generation/records":e.startsWith("/event-graph/detail/")?(console.log("匹配到事件图详情页，高亮菜单:","/event-graph/detail"),"/event-graph/detail"):e.startsWith("/event-graph/edit/")?"/event-graph/edit":e.startsWith("/event-graph/visualize/")?(console.log("匹配到事件图可视化页，高亮菜单:","/event-graph/visualize"),"/event-graph/visualize"):e.startsWith("/user/profile")?"/user/profile":e.startsWith("/user/change-password")?"/user/change-password":e.includes("/detail/")||e.includes("/edit/")?e.substring(0,e.lastIndexOf("/")):(console.log("默认使用当前路径:",e),e)})),_=async()=>{try{await e.dispatch("logout"),t.push("/login")}catch(n){console.error("退出登录失败:",n)}},F=()=>{console.error("导航栏头像加载失败"),console.error("原始头像URL:",e.state.user.avatar_url),console.error("计算后的头像URL:",y.value),document.querySelector(".avatar-wrapper .el-avatar").style.backgroundColor="#1890ff"},w=async e=>{e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation());try{const e=await(0,b.Z$)();let n=[];if(e&&Array.isArray(e)?n=e:e&&e.success&&Array.isArray(e.data)&&(n=e.data),n.length>0){const e=[...n].sort(((e,t)=>e.id-t.id))[0];t.replace(`/event-graph/detail/${e.id}`)}else x.nk.warning("没有可查看的事件图")}catch(n){console.error("获取事件图列表失败:",n),x.nk.error("获取事件图列表失败")}},L=async e=>{e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation());try{const e=await(0,b.Z$)();let n=[];if(e&&Array.isArray(e)?n=e:e&&e.success&&Array.isArray(e.data)&&(n=e.data),n.length>0){const e=[...n].sort(((e,t)=>e.id-t.id))[0];t.replace(`/event-graph/visualize/${e.id}`)}else x.nk.warning("没有可查看的事件图")}catch(n){console.error("获取事件图列表失败:",n),x.nk.error("获取事件图列表失败")}},R=async e=>{e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation());try{const e=await(0,b.Z$)();let n=[];if(e&&Array.isArray(e)?n=e:e&&e.success&&Array.isArray(e.data)&&(n=e.data),n.length>0){const e=[...n].sort(((e,t)=>e.id-t.id))[0];t.replace(`/text-generation/create?eventGraphId=${e.id}`)}else x.nk.warning("没有可查看的事件图")}catch(n){console.error("获取事件图列表失败:",n),x.nk.error("获取事件图列表失败")}},$=async e=>{e&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation());try{const e=await(0,b.Z$)();let n=[];if(e&&Array.isArray(e)?n=e:e&&e.success&&Array.isArray(e.data)&&(n=e.data),n.length>0){const e=[...n].sort(((e,t)=>e.id-t.id))[0];t.replace(`/text-generation/records/${e.id}`)}else x.nk.warning("没有可查看的事件图")}catch(n){console.error("获取事件图列表失败:",n),x.nk.error("获取事件图列表失败")}};return{menuRef:a,appMainRef:i,sidebarRef:s,userName:g,userAvatar:y,userInitials:A,activeMenu:E,handleLogout:_,router:t,handleAvatarError:F,goToFirstEventGraphEdit:w,goToFirstEventGraphVisualize:L,goToFirstEventGraphGeneration:R,goToFirstEventGraphRecords:$,handleSidebarScroll:h}}},A=n(1241);const E=(0,A.A)(y,[["render",g],["__scopeId","data-v-24eae7bf"]]);var _=E;const F=[{path:"/login",name:"Login",component:()=>n.e(14).then(n.bind(n,9633)),meta:{title:"登录",public:!0}},{path:"/register",name:"Register",component:()=>n.e(619).then(n.bind(n,619)),meta:{title:"注册",public:!0}},{path:"/",name:"Layout",component:_,redirect:"/home",children:[{path:"home",name:"Home",component:()=>Promise.all([n.e(464),n.e(366)]).then(n.bind(n,4366)),meta:{title:"首页"}}]},{path:"/event-graph",component:_,redirect:"/event-graph/list",meta:{title:"事件图管理",icon:"event"},children:[{path:"list",component:()=>n.e(583).then(n.bind(n,3583)),name:"EventGraphList",meta:{title:"事件图列表"}},{path:"create",component:()=>n.e(344).then(n.bind(n,5344)),name:"CreateEventGraph",meta:{title:"编辑事件图",activeMenu:"/event-graph/list",hidden:!0}},{path:"edit/:id",component:()=>n.e(344).then(n.bind(n,5344)),name:"EditEventGraph",meta:{title:"编辑事件图",activeMenu:"/event-graph/list",hidden:!0},props:!0},{path:"detail/:id",component:()=>n.e(332).then(n.bind(n,3332)),name:"EventGraphDetail",meta:{title:"事件图详情"},props:!0},{path:"node-edit/:id",component:()=>n.e(250).then(n.bind(n,8250)),name:"EditEventNode",meta:{title:"编辑事件节点",activeMenu:"/event-graph/list"},props:!0},{path:"edge-edit/:id",component:()=>n.e(458).then(n.bind(n,7458)),name:"EditEventEdge",meta:{title:"编辑事件关系",activeMenu:"/event-graph/list"},props:!0},{path:"visualize/:id",component:()=>Promise.all([n.e(464),n.e(795)]).then(n.bind(n,5795)),name:"VisualizeEventGraph",meta:{title:"事件图可视化",activeMenu:"/event-graph/visualize"},props:!0}]},{path:"/text-style",component:_,redirect:"/text-style/list",meta:{title:"文本风格管理",icon:"style"},children:[{path:"list",component:()=>n.e(421).then(n.bind(n,5421)),name:"TextStyleList",meta:{title:"风格列表"}},{path:"create",component:()=>n.e(978).then(n.bind(n,4978)),name:"CreateTextStyle",meta:{title:"创建风格"}},{path:"edit/:id",component:()=>n.e(978).then(n.bind(n,4978)),name:"EditTextStyle",meta:{title:"编辑风格"},props:!0}]},{path:"/text-generation",component:_,redirect:"/text-generation/list",meta:{title:"文本生成",icon:"document"},children:[{path:"list",component:()=>n.e(258).then(n.bind(n,4649)),name:"TextGenerationList",meta:{title:"全部记录"}},{path:"create",component:()=>n.e(26).then(n.bind(n,8969)),name:"CreateTextGeneration",meta:{title:"生成新文本"}},{path:"detail/:id",component:()=>n.e(697).then(n.bind(n,5579)),name:"TextGenerationDetail",meta:{title:"文本详情"},props:!0},{path:"records",component:()=>n.e(390).then(n.bind(n,2155)),name:"TextGenerationRecordList",meta:{title:"生成记录列表"}},{path:"records/:id",component:()=>n.e(4).then(n.bind(n,4534)),name:"TextGenerationRecords",meta:{title:"生成记录",activeMenu:"/text-generation/records"},props:!0}]},{path:"/user",component:_,redirect:"/user/profile",children:[{path:"profile",component:()=>n.e(847).then(n.bind(n,847)),name:"UserProfile",meta:{title:"个人资料"}},{path:"change-password",component:()=>n.e(278).then(n.bind(n,1278)),name:"ChangePassword",meta:{title:"修改密码"}}]},{path:"/404",component:()=>n.e(593).then(n.bind(n,6593)),meta:{title:"404",public:!0}},{path:"/:pathMatch(.*)*",redirect:"/404",hidden:!0}],w=(0,r.aE)({history:(0,r.LA)(),routes:F});w.beforeEach(((e,t,n)=>{const r=(0,a.gf)();r?"/login"===e.path?n({path:"/"}):n():e.meta.public?n():n(`/login?redirect=${e.path}`)}));var L=w},3603:function(e,t,n){n.d(t,{WG:function(){return o},eF:function(){return i},gf:function(){return a}});const r="User-Token";function a(){return localStorage.getItem(r)}function o(e){if(e&&"string"===typeof e)return localStorage.setItem(r,e);console.error("Invalid token format:",e)}function i(){return localStorage.removeItem(r)}},5720:function(e,t,n){n.d(t,{o:function(){return l}});n(4114);var r=n(4373),a=n(3603),o=n(1219),i=n(3281);const s=r.A.create({baseURL:"https://eventgraphtotext-backend-production.up.railway.app",timeout:12e4});function l(e){if(!e)return"";let t=e;return t.includes("avatar=")&&(t=t.replace("avatar=","avatar/")),t.startsWith("/")||t.startsWith("http")||(t="/"+t),t}s.interceptors.request.use((e=>{console.log("发送请求:",e.method.toUpperCase(),e.url);const t=(0,a.gf)();return console.log("Raw token from storage:",t),t&&"string"===typeof t&&3===t.split(".").length?(e.headers["Authorization"]=`Bearer ${t}`,console.log("Authorization header set:",e.headers["Authorization"])):t&&(console.error("Invalid token format found in storage:",t),(0,a.eF)()),e}),(e=>(console.log("请求错误:",e),Promise.reject(e)))),s.interceptors.response.use((e=>{if(console.log("收到响应:",e.config.method.toUpperCase(),e.config.url,e.status),"blob"===e.config.responseType)return console.log("收到blob响应，直接返回数据"),e.data;console.log("响应数据:",e.data);const t=e.data;return t}),(e=>{console.log("API Error:",e),console.log("Error Response:",e.response);const t=e.response?.data?.message||e.message||"请求失败";return(0,o.nk)({message:t,type:"error",duration:5e3}),401===e.response?.status&&i.A.push("/login"),Promise.reject(e)})),t.A=s},8270:function(e,t,n){n.d(t,{$d:function(){return c},BU:function(){return i},G5:function(){return m},PA:function(){return d},Qi:function(){return l},VC:function(){return p},Z$:function(){return a},aR:function(){return o},d3:function(){return k},di:function(){return v},gq:function(){return g},im:function(){return s},kD:function(){return h},kW:function(){return u},yQ:function(){return f}});var r=n(5720);function a(){return(0,r.A)({url:"/api/event_graphs",method:"get"})}function o(e){return(0,r.A)({url:`/api/event_graphs/${e}`,method:"get"})}function i(e){return(0,r.A)({url:"/api/event_graphs",method:"post",data:e})}function s(e,t){return(0,r.A)({url:`/api/event_graphs/${e}`,method:"put",data:t})}function l(e){return(0,r.A)({url:`/api/event_graphs/${e}`,method:"delete"})}function u(e){return(0,r.A)({url:`/api/graph/${e}/data`,method:"get"})}function c(e,t){return(0,r.A)({url:`/api/graph/${e}/data`,method:"post",data:t})}function p(e){return(0,r.A)({url:`/api/graph/nodes/${e}`,method:"get"})}function d(e){return(0,r.A)({url:"/api/graph/nodes",method:"post",data:e})}function h(e,t){return(0,r.A)({url:`/api/graph/nodes/${e}`,method:"put",data:t})}function g(e){return(0,r.A)({url:`/api/graph/nodes/${e}`,method:"delete"})}function f(e){return(0,r.A)({url:`/api/graph/edges/${e}`,method:"get"})}function m(e){return(0,r.A)({url:"/api/graph/edges",method:"post",data:e})}function v(e,t){return(0,r.A)({url:`/api/graph/edges/${e}`,method:"put",data:t})}function k(e){return(0,r.A)({url:`/api/graph/edges/${e}`,method:"delete"})}},8552:function(e,t,n){var r=n(5130),a=n(6768);function o(e,t,n,r,o,i){const s=(0,a.g2)("router-view");return(0,a.uX)(),(0,a.Wv)(s)}var i=n(4249),s=n(3603),l={setup(){const e=(0,i.Pj)();(0,a.sV)((()=>{(0,s.gf)()&&e.dispatch("getUserInfo").catch((e=>{console.error("Failed to get user info on app mount:",e)}))}))}},u=n(1241);const c=(0,u.A)(l,[["render",o]]);var p=c,d=n(1608),h=(n(4188),n(2721)),g=n(2549),f=(0,i.y$)({state:{token:(0,s.gf)()||"",user:JSON.parse(localStorage.getItem("user")||"{}")},mutations:{SET_TOKEN(e,t){console.log("Setting token:",t),e.token=t,(0,s.WG)(t)},SET_USER(e,t){e.user=t,localStorage.setItem("user",JSON.stringify(t))},CLEAR_USER(e){e.token="",e.user={},(0,s.eF)(),localStorage.removeItem("user")}},actions:{login({commit:e},t){return new Promise(((n,r)=>{(0,g.iD)(t).then((t=>{if(console.log("Raw login response:",t),!t||"object"!==typeof t)throw new Error("Invalid response format");let a=null,o=null;t.token&&"string"===typeof t.token?(a=t.token,o=t.user):t.data?(t.data.token&&"string"===typeof t.data.token?a=t.data.token:t.data.token&&t.data.token.access_token&&(a=t.data.token.access_token),o=t.data.user):t.token&&t.token.access_token&&(a=t.token.access_token,o=t.user),console.log("Extracted token:",a),console.log("Extracted user data:",o),a?(e("SET_TOKEN",a),o&&e("SET_USER",o),n(t)):(console.error("No valid token found in response:",t),r(new Error("登录失败：未获取到有效的token")))})).catch((t=>{console.error("Login error:",t),e("CLEAR_USER"),r(t)}))}))},getUserInfo({commit:e}){return new Promise(((t,n)=>{(0,g.HW)().then((r=>{console.log("获取用户信息成功:",r);let a=null;r&&r.success&&r.data?a=r.data:r&&r.id&&(a=r),a?(e("SET_USER",a),t(a)):n(new Error("获取用户信息失败：无法提取有效的用户数据"))})).catch((e=>{console.error("获取用户信息失败:",e),n(e)}))}))},logout({commit:e}){return new Promise(((t,n)=>{(0,g.ri)().then((()=>{e("CLEAR_USER"),t()})).catch((t=>{e("CLEAR_USER"),n(t)}))}))}},getters:{token:e=>e.token,user:e=>e.user}}),m=n(3281),v=n(5720);const k=console.error;console.error=function(e,...t){if(!e||"string"!==typeof e||!e.includes("ResizeObserver loop completed with undelivered notifications"))return k.apply(console,[e,...t])};const b=(0,r.Ef)(p);b.config.globalProperties.$http=v.A,b.use(d.A,{locale:h.A}),b.use(f),b.use(m.A),b.mount("#app")}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[145,444,122,386,866,301,118,234,321,389,834,271,415,454,221,470,315,247,566,233,633,558,899,680,274,774],(function(){return t(8552)}));e.O()}]);