"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[390],{2155:function(e,t,l){l.r(t),l.d(t,{default:function(){return v}});l(4114),l(8111),l(2489);var n=l(6768),a=l(5130),r=l(4232),o=l(144),i=l(1387),u=l(1219),s=l(8426);const d={class:"record-list-container"},c={class:"table-container"},p={class:"content-preview"},g={class:"pagination-container"};var f={__name:"record-list",setup(e){const t=(0,i.rd)(),l=(0,o.KR)(!1),f=(0,o.KR)([]),h=(0,o.KR)(0),m=(0,o.Kh)({page:1,limit:10,eventGraphId:"",styleId:""}),v=e=>e||"",b=async()=>{f.value=[],l.value=!0,console.log("开始获取生成记录列表...");try{const e=await(0,s.Vy)();console.log("获取到API响应:",e);let t=[];if(Array.isArray(e))t=e,console.log(`直接获取到${t.length}条记录`);else{if(!(e&&e.success&&Array.isArray(e.data)))return console.error("获取记录失败，服务器返回了非预期格式的数据:",e),u.nk.error("获取生成记录失败：无效数据格式"),f.value=[],void(h.value=0);t=e.data,console.log(`从响应data字段获取到${t.length}条记录`)}const l=k(t);console.log(`过滤后剩余${l.length}条记录`),h.value=l.length;const n=Math.ceil(l.length/m.limit)||1;m.page>n&&(console.log(`当前页码(${m.page})超出最大页码(${n})，重置为第一页`),m.page=1);const a=(m.page-1)*m.limit,r=a+m.limit;f.value=l.slice(a,r),console.log(`当前页显示${f.value.length}条记录`)}catch(e){console.error("获取生成记录列表失败:",e),u.nk.error(`获取生成记录列表失败: ${e.message||"未知错误"}`),f.value=[],h.value=0}finally{l.value=!1,console.log("记录列表加载完成")}},k=e=>e.filter((e=>(!m.eventGraphId||e.eventGraphId.toString()===m.eventGraphId)&&(!m.styleId||!e.styleId||e.styleId.toString()===m.styleId))),y=()=>{m.page=1,b()},_=()=>{m.eventGraphId="",m.styleId="",y()},I=e=>{m.page=e,b()},w=e=>{m.limit=e,b()},F=e=>{t.push(`/text-generation/detail/${e}`)},x=e=>{t.push(`/text-generation/records/${e}`)},A=async e=>{try{l.value=!0,console.log("开始删除文本记录，ID:",e),await(0,s.gL)(e),u.nk.success("删除成功"),console.log("删除成功，开始强制刷新页面"),f.value=f.value.filter((t=>t.id!==e));let t=0;const n=3,a=async()=>{t++,console.log(`第${t}次尝试刷新记录列表...`);try{await b(),console.log("刷新成功")}catch(e){console.error(`第${t}次刷新失败:`,e),t<n?setTimeout(a,500):console.log("达到最大尝试次数，不再重试")}};setTimeout(a,300)}catch(t){console.error("删除文本记录失败:",t),u.nk.error(`删除失败: ${t.message||"未知错误"}`),l.value=!1}};return(0,n.sV)((()=>{b()})),(e,t)=>{const o=(0,n.g2)("el-input"),i=(0,n.g2)("el-form-item"),u=(0,n.g2)("el-button"),s=(0,n.g2)("el-form"),b=(0,n.g2)("el-card"),k=(0,n.g2)("el-table-column"),$=(0,n.g2)("el-popconfirm"),C=(0,n.g2)("el-table"),G=(0,n.g2)("el-pagination"),D=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",d,[t[9]||(t[9]=(0,n.Lk)("div",{class:"page-header"},[(0,n.Lk)("h2",null,"文本生成记录")],-1)),(0,n.bF)(b,{class:"filter-container"},{default:(0,n.k6)((()=>[(0,n.bF)(s,{inline:!0,model:m,class:"filter-form"},{default:(0,n.k6)((()=>[(0,n.bF)(i,{label:"事件图ID"},{default:(0,n.k6)((()=>[(0,n.bF)(o,{modelValue:m.eventGraphId,"onUpdate:modelValue":t[0]||(t[0]=e=>m.eventGraphId=e),placeholder:"输入事件图ID",clearable:"",onKeyup:(0,a.jR)(y,["enter"])},null,8,["modelValue"])])),_:1}),(0,n.bF)(i,{label:"风格ID"},{default:(0,n.k6)((()=>[(0,n.bF)(o,{modelValue:m.styleId,"onUpdate:modelValue":t[1]||(t[1]=e=>m.styleId=e),placeholder:"输入风格ID",clearable:"",onKeyup:(0,a.jR)(y,["enter"])},null,8,["modelValue"])])),_:1}),(0,n.bF)(i,null,{default:(0,n.k6)((()=>[(0,n.bF)(u,{type:"primary",onClick:y},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("搜索")]))),_:1}),(0,n.bF)(u,{onClick:_},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),(0,n.Lk)("div",c,[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(C,{data:f.value,border:"",style:{width:"100%"}},{default:(0,n.k6)((()=>[(0,n.bF)(k,{prop:"id",label:"ID",width:"80"}),(0,n.bF)(k,{prop:"eventGraphId",label:"事件图ID",width:"100"}),(0,n.bF)(k,{prop:"styleId",label:"风格ID",width:"100"}),(0,n.bF)(k,{label:"内容","show-overflow-tooltip":""},{default:(0,n.k6)((e=>[(0,n.Lk)("div",p,(0,r.v_)(e.row.content),1)])),_:1}),(0,n.bF)(k,{label:"创建时间",width:"180"},{default:(0,n.k6)((e=>[(0,n.eW)((0,r.v_)(v(e.row.createdAt)),1)])),_:1}),(0,n.bF)(k,{label:"操作",width:"180",fixed:"right"},{default:(0,n.k6)((e=>[(0,n.bF)(u,{link:"",type:"primary",size:"small",onClick:t=>F(e.row.id)},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("查看详情")]))),_:2},1032,["onClick"]),(0,n.bF)(u,{link:"",type:"primary",size:"small",onClick:t=>x(e.row.eventGraphId)},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("事件图记录")]))),_:2},1032,["onClick"]),(0,n.bF)($,{title:"确定删除此记录?",onConfirm:t=>A(e.row.id)},{reference:(0,n.k6)((()=>[(0,n.bF)(u,{link:"",type:"danger",size:"small"},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[D,l.value]]),(0,n.Lk)("div",g,[(0,n.bF)(G,{"current-page":m.page,"onUpdate:currentPage":t[2]||(t[2]=e=>m.page=e),"page-size":m.limit,"onUpdate:pageSize":t[3]||(t[3]=e=>m.limit=e),"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:h.value,onSizeChange:w,onCurrentChange:I},null,8,["current-page","page-size","total"])])])])}}},h=l(1241);const m=(0,h.A)(f,[["__scopeId","data-v-5fff5246"]]);var v=m},8426:function(e,t,l){l.d(t,{$R:function(){return p},A_:function(){return r},Db:function(){return o},PH:function(){return d},U6:function(){return i},Vy:function(){return a},Xi:function(){return c},Yz:function(){return s},gL:function(){return u},qV:function(){return g}});var n=l(5720);function a(){return(0,n.A)({url:"/api/generated_texts/all",method:"get",params:{_t:(new Date).getTime()},headers:{"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}})}function r(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"get"})}function o(e){return(0,n.A)({url:"/api/generated_texts",method:"post",data:e})}function i(e){return(0,n.A)({url:"/api/generated_texts/latest",method:"get",params:{eventGraphId:e}})}function u(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"delete"})}function s(e){return console.log("开始请求事件图生成记录，事件图ID:",e),(0,n.A)({url:"/api/generated_texts",method:"get",params:{eventGraphId:e}})}function d(e){return(0,n.A)({url:"/api/generated_texts/export",method:"get",params:{eventGraphId:e},responseType:"blob"})}function c(){return(0,n.A)({url:"/api/generated_texts/export/all",method:"get",responseType:"blob"})}function p(e){return(0,n.A)({url:`/generated_texts/${e}/status`,method:"get"})}function g(e,t){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"put",data:t})}}}]);