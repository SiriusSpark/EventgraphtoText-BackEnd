"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[250],{8250:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});a(4114),a(8111),a(2489),a(3579);var t=a(6768),n=a(4232),o=a(5130),i=a(144),r=a(1387),s=a(1219),d=a(164),u=a(8270);const c={class:"node-edit-container"},m={class:"page-header"},p={class:"header-actions"},b={class:"main-content"},T={class:"date-input-wrapper"},v={class:"date-input-wrapper"};var k={__name:"node-edit",setup(e){const l=(0,r.lq)(),a=(0,r.rd)(),k=(0,i.KR)(null),f=(0,i.KR)(null),g=(0,i.KR)(!1),h=(0,i.KR)(!1),V=(0,i.KR)(!1),y=(0,i.KR)(!1),Y=(0,i.KR)(""),_=(0,i.KR)(l.params.id||""),F=(0,i.Kh)({eventGraphId:"",title:"",description:"",location:"",startTime:"",endTime:"",startTimeText:"",endTimeText:"",labels:[]}),x=(0,i.Kh)({eventGraphId:"",title:"",description:"",location:"",startTime:"",endTime:"",labels:[]}),I={title:[{required:!0,message:"请输入事件标题",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入事件描述",trigger:"blur"}]},D=async()=>{if(_.value){g.value=!0;try{const e=await(0,u.VC)(_.value);if(e&&e.success&&e.data){const l=e.data;F.eventGraphId=l.eventGraphId||"",F.title=l.title||"",F.description=l.description||"",F.location=l.location||"",F.startTime=l.startTime||"",F.endTime=l.endTime||"",F.startTimeText=l.startTime||"",F.endTimeText=l.endTime||"",F.labels=l.labels||[],Object.assign(x,{eventGraphId:l.eventGraphId||"",title:l.title||"",description:l.description||"",location:l.location||"",startTime:l.startTime||"",endTime:l.endTime||"",labels:[...l.labels||[]]})}else s.nk.error(e?.message||e?.error||"获取节点详情失败")}catch(e){console.error("获取节点详情失败:",e),s.nk.error("获取节点详情失败")}finally{g.value=!1}}else s.nk.error("未找到节点ID")},C=e=>{F.startTime=F.startTimeText},w=e=>{F.endTime=F.endTimeText},K=e=>{e&&(F.startTimeText=e)},M=e=>{e&&(F.endTimeText=e)},R=()=>{k.value.validate((async e=>{if(e){h.value=!0;try{const e={};F.title!==x.title&&(e.title=F.title),F.description!==x.description&&(e.description=F.description),F.location!==x.location&&(e.location=F.location),F.startTime!==x.startTime&&(e.startTime=F.startTime),F.endTime!==x.endTime&&(e.endTime=F.endTime);const l=F.labels.length!==x.labels.length||F.labels.some(((e,l)=>e!==x.labels[l]));if(l&&(e.labels=F.labels),0===Object.keys(e).length)return s.nk.info("没有字段被修改，不需要保存"),void(h.value=!1);const a=await(0,u.kD)(_.value,e);a&&a.success?(s.nk.success("保存成功"),L()):s.nk.error(a?.message||a?.error||"保存失败")}catch(l){console.error("保存失败:",l),s.nk.error("保存失败")}finally{h.value=!1}}}))},W=()=>{y.value=!0,(0,t.dY)((()=>{f.value.focus()}))},G=()=>{Y.value&&(F.labels.includes(Y.value)||F.labels.push(Y.value)),y.value=!1,Y.value=""},U=e=>{F.labels=F.labels.filter((l=>l!==e))},X=async()=>{try{await d.s.confirm("确定要删除该节点吗？相关的所有关系也会被删除!","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.value=!0;const e=await(0,u.gq)(_.value);e&&e.success?(s.nk.success("删除成功"),L()):s.nk.error(e?.message||e?.error||"删除失败")}catch(e){"cancel"!==e&&(console.error("删除失败:",e),s.nk.error("删除失败"))}finally{V.value=!1}},L=()=>{a.back()};return(0,t.sV)((()=>{D()})),(e,l)=>{const a=(0,t.g2)("el-button"),i=(0,t.g2)("el-input"),r=(0,t.g2)("el-form-item"),s=(0,t.g2)("el-date-picker"),d=(0,t.g2)("el-tag"),u=(0,t.g2)("el-form"),x=(0,t.g2)("el-empty"),D=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",c,[(0,t.Lk)("div",m,[l[10]||(l[10]=(0,t.Lk)("h2",null,"编辑事件节点",-1)),(0,t.Lk)("div",p,[(0,t.bF)(a,{onClick:L},{default:(0,t.k6)((()=>l[9]||(l[9]=[(0,t.eW)("返回")]))),_:1})])]),(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",b,[_.value?((0,t.uX)(),(0,t.Wv)(u,{key:0,ref_key:"formRef",ref:k,model:F,rules:I,"label-width":"100px",class:"node-form"},{default:(0,t.k6)((()=>[(0,t.bF)(r,{label:"事件图ID",prop:"eventGraphId"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:F.eventGraphId,"onUpdate:modelValue":l[0]||(l[0]=e=>F.eventGraphId=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(r,{label:"标题",prop:"title"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:F.title,"onUpdate:modelValue":l[1]||(l[1]=e=>F.title=e),placeholder:"请输入事件标题"},null,8,["modelValue"])])),_:1}),(0,t.bF)(r,{label:"描述",prop:"description"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:F.description,"onUpdate:modelValue":l[2]||(l[2]=e=>F.description=e),type:"textarea",rows:3,placeholder:"请输入事件描述"},null,8,["modelValue"])])),_:1}),(0,t.bF)(r,{label:"位置",prop:"location"},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:F.location,"onUpdate:modelValue":l[3]||(l[3]=e=>F.location=e),placeholder:"事件发生的地点"},null,8,["modelValue"])])),_:1}),(0,t.bF)(r,{label:"开始时间",prop:"startTime"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",T,[(0,t.bF)(i,{modelValue:F.startTimeText,"onUpdate:modelValue":l[4]||(l[4]=e=>F.startTimeText=e),placeholder:"格式：YYYY-MM-DD",class:"date-input",onInput:C},null,8,["modelValue"]),(0,t.bF)(s,{modelValue:F.startTime,"onUpdate:modelValue":l[5]||(l[5]=e=>F.startTime=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker",onChange:K},null,8,["modelValue"])])])),_:1}),(0,t.bF)(r,{label:"结束时间",prop:"endTime"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",v,[(0,t.bF)(i,{modelValue:F.endTimeText,"onUpdate:modelValue":l[6]||(l[6]=e=>F.endTimeText=e),placeholder:"格式：YYYY-MM-DD",class:"date-input",onInput:w},null,8,["modelValue"]),(0,t.bF)(s,{modelValue:F.endTime,"onUpdate:modelValue":l[7]||(l[7]=e=>F.endTime=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"date-picker",onChange:M},null,8,["modelValue"])])])),_:1}),(0,t.bF)(r,{label:"标签",prop:"labels"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(F.labels,(e=>((0,t.uX)(),(0,t.Wv)(d,{key:e,closable:"",onClose:l=>U(e),class:"tag-item"},{default:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e),1)])),_:2},1032,["onClose"])))),128)),y.value?((0,t.uX)(),(0,t.Wv)(i,{key:0,ref_key:"tagInputRef",ref:f,modelValue:Y.value,"onUpdate:modelValue":l[8]||(l[8]=e=>Y.value=e),class:"tag-input",size:"small",onKeyup:(0,o.jR)(G,["enter"]),onBlur:G},null,8,["modelValue"])):((0,t.uX)(),(0,t.Wv)(a,{key:1,class:"button-new-tag",size:"small",onClick:W},{default:(0,t.k6)((()=>l[11]||(l[11]=[(0,t.eW)(" + 新标签 ")]))),_:1}))])),_:1}),(0,t.bF)(r,null,{default:(0,t.k6)((()=>[(0,t.bF)(a,{type:"primary",onClick:R,loading:h.value},{default:(0,t.k6)((()=>l[12]||(l[12]=[(0,t.eW)("保存")]))),_:1},8,["loading"]),(0,t.bF)(a,{type:"danger",onClick:X,loading:V.value},{default:(0,t.k6)((()=>l[13]||(l[13]=[(0,t.eW)("删除")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])):((0,t.uX)(),(0,t.Wv)(x,{key:1,description:"未找到节点信息"}))])),[[D,g.value]])])}}},f=a(1241);const g=(0,f.A)(k,[["__scopeId","data-v-06c2f5d8"]]);var h=g}}]);