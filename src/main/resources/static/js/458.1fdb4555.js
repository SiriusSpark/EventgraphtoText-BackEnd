"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[458],{7458:function(e,l,a){a.r(l),a.d(l,{default:function(){return k}});var t=a(6768),r=a(144),u=a(1387),n=a(1219),d=a(164),o=a(8270);const s={class:"edge-edit-container"},c={class:"page-header"},i={class:"header-actions"},g={class:"main-content"};var v={__name:"edge-edit",setup(e){const l=(0,u.lq)(),a=(0,u.rd)(),v=(0,r.KR)(null),b=(0,r.KR)(!1),p=(0,r.KR)(!1),k=(0,r.KR)(!1),f=(0,r.KR)(!1),h=(0,r.KR)([]),m=(0,r.KR)(l.params.id||""),y=(0,r.Kh)({eventGraphId:"",sourceId:"",targetId:"",type:"",strength:""}),I=["CAUSES","RESULTS_IN"],F=(0,t.EW)((()=>I.includes(y.type))),_=e=>{I.includes(e)?y.strength||(y.strength="中"):y.strength=""},E={sourceId:[{required:!0,message:"请选择起始节点",trigger:"change"}],type:[{required:!0,message:"请选择关系类型",trigger:"change"}],targetId:[{required:!0,message:"请选择目标节点",trigger:"change"}],strength:[{required:!0,message:"请选择关系强度",trigger:"change",validator:(e,l,a)=>{F.value&&!l?a(new Error("请选择关系强度")):a()}}]},V=async()=>{if(m.value){b.value=!0;try{const e=await(0,o.yQ)(m.value);if(console.log("关系详情响应:",e),e&&e.success&&e.data){const l=e.data;y.eventGraphId=l.eventGraphId||"",y.sourceId=l.sourceId||"",y.targetId=l.targetId||"",y.type=l.type||"",y.strength=l.strength||"",C(l.eventGraphId)}else n.nk.error(e?.message||e?.error||"获取关系详情失败")}catch(e){console.error("获取关系详情失败:",e),n.nk.error("获取关系详情失败")}finally{b.value=!1}}else n.nk.error("未找到关系ID")},C=async e=>{if(e){f.value=!0;try{const l=await(0,o.kW)(e);l&&l.nodes&&(h.value=l.nodes)}catch(l){console.error("获取事件图节点失败:",l)}finally{f.value=!1}}},R=()=>{v.value.validate((async e=>{if(e){p.value=!0;try{const e={eventGraphId:y.eventGraphId,sourceId:y.sourceId,targetId:y.targetId,type:y.type};I.includes(y.type)&&(e.strength=y.strength);const l=await(0,o.di)(m.value,e);l&&l.success?(n.nk.success("保存成功"),U()):n.nk.error(l?.message||l?.error||"保存失败")}catch(l){console.error("保存失败:",l),n.nk.error("保存失败")}finally{p.value=!1}}}))},S=async()=>{try{await d.s.confirm("确定要删除该关系吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0;const e=await(0,o.d3)(m.value);e&&e.success?(n.nk.success("删除成功"),U()):n.nk.error(e?.message||e?.error||"删除失败")}catch(e){"cancel"!==e&&(console.error("删除失败:",e),n.nk.error("删除失败"))}finally{k.value=!1}},U=()=>{a.back()};return(0,t.sV)((()=>{V()})),(e,l)=>{const a=(0,t.g2)("el-button"),r=(0,t.g2)("el-input"),u=(0,t.g2)("el-form-item"),n=(0,t.g2)("el-option"),d=(0,t.g2)("el-select"),o=(0,t.g2)("el-option-group"),I=(0,t.g2)("el-form"),V=(0,t.g2)("el-empty"),C=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.Lk)("div",c,[l[6]||(l[6]=(0,t.Lk)("h2",null,"编辑事件关系",-1)),(0,t.Lk)("div",i,[(0,t.bF)(a,{onClick:U},{default:(0,t.k6)((()=>l[5]||(l[5]=[(0,t.eW)("返回")]))),_:1})])]),(0,t.bo)(((0,t.uX)(),(0,t.CE)("div",g,[m.value?((0,t.uX)(),(0,t.Wv)(I,{key:0,ref_key:"formRef",ref:v,model:y,rules:E,"label-width":"100px",class:"edge-form"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{label:"事件图ID",prop:"eventGraphId"},{default:(0,t.k6)((()=>[(0,t.bF)(r,{modelValue:y.eventGraphId,"onUpdate:modelValue":l[0]||(l[0]=e=>y.eventGraphId=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(u,{label:"起始节点",prop:"sourceId"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:y.sourceId,"onUpdate:modelValue":l[1]||(l[1]=e=>y.sourceId=e),placeholder:"选择起始节点",filterable:"",loading:f.value},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(h.value,(e=>((0,t.uX)(),(0,t.Wv)(n,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),(0,t.bF)(u,{label:"关系类型",prop:"type"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:y.type,"onUpdate:modelValue":l[2]||(l[2]=e=>y.type=e),placeholder:"选择关系类型",onChange:_},{default:(0,t.k6)((()=>[(0,t.bF)(o,{label:"时间关系"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"先于",value:"PRECEDES"}),(0,t.bF)(n,{label:"后于",value:"FOLLOWS"}),(0,t.bF)(n,{label:"同时",value:"CONCURRENT_WITH"})])),_:1}),(0,t.bF)(o,{label:"因果关系"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"导致",value:"CAUSES"}),(0,t.bF)(n,{label:"结果",value:"RESULTS_IN"})])),_:1}),(0,t.bF)(o,{label:"共指关系"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"共指",value:"COREFERS_TO"})])),_:1}),(0,t.bF)(o,{label:"子事件关系"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"包含子事件",value:"HAS_SUBEVENT"}),(0,t.bF)(n,{label:"属于",value:"SUBEVENT_OF"})])),_:1})])),_:1},8,["modelValue"])])),_:1}),F.value?((0,t.uX)(),(0,t.Wv)(u,{key:0,label:"关系强度",prop:"strength"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:y.strength,"onUpdate:modelValue":l[3]||(l[3]=e=>y.strength=e),placeholder:"选择关系强度"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"高",value:"高"}),(0,t.bF)(n,{label:"中",value:"中"}),(0,t.bF)(n,{label:"低",value:"低"})])),_:1},8,["modelValue"])])),_:1})):(0,t.Q3)("",!0),(0,t.bF)(u,{label:"目标节点",prop:"targetId"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{modelValue:y.targetId,"onUpdate:modelValue":l[4]||(l[4]=e=>y.targetId=e),placeholder:"选择目标节点",filterable:"",loading:f.value},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(h.value,(e=>((0,t.uX)(),(0,t.Wv)(n,{key:e.id,label:e.title,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)(a,{type:"primary",onClick:R,loading:p.value},{default:(0,t.k6)((()=>l[7]||(l[7]=[(0,t.eW)("保存")]))),_:1},8,["loading"]),(0,t.bF)(a,{type:"danger",onClick:S,loading:k.value},{default:(0,t.k6)((()=>l[8]||(l[8]=[(0,t.eW)("删除")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])):((0,t.uX)(),(0,t.Wv)(V,{key:1,description:"未找到关系信息"}))])),[[C,b.value]])])}}},b=a(1241);const p=(0,b.A)(v,[["__scopeId","data-v-03cab38f"]]);var k=p}}]);