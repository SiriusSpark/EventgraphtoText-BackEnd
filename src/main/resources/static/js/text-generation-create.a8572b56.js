"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[26],{288:function(e,t,l){l.d(t,{CW:function(){return r},Kl:function(){return o},VB:function(){return u},Yh:function(){return s},hs:function(){return n}});var a=l(5720);function n(){return(0,a.A)({url:"/api/text_styles",method:"get"})}function r(e){return(0,a.A)({url:`/api/text_styles/${e}`,method:"get"})}function u(e){return(0,a.A)({url:"/api/text_styles",method:"post",data:e})}function s(e,t){return(0,a.A)({url:`/api/text_styles/${e}`,method:"put",data:t})}function o(e){return(0,a.A)({url:`/api/text_styles/${e}`,method:"delete"})}},8426:function(e,t,l){l.d(t,{$R:function(){return v},A_:function(){return r},Db:function(){return u},PH:function(){return i},U6:function(){return s},Vy:function(){return n},Xi:function(){return c},Yz:function(){return d},gL:function(){return o},qV:function(){return p}});var a=l(5720);function n(){return(0,a.A)({url:"/api/generated_texts/all",method:"get",params:{_t:(new Date).getTime()},headers:{"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}})}function r(e){return(0,a.A)({url:`/api/generated_texts/${e}`,method:"get"})}function u(e){return(0,a.A)({url:"/api/generated_texts",method:"post",data:e})}function s(e){return(0,a.A)({url:"/api/generated_texts/latest",method:"get",params:{eventGraphId:e}})}function o(e){return(0,a.A)({url:`/api/generated_texts/${e}`,method:"delete"})}function d(e){return console.log("开始请求事件图生成记录，事件图ID:",e),(0,a.A)({url:"/api/generated_texts",method:"get",params:{eventGraphId:e}})}function i(e){return(0,a.A)({url:"/api/generated_texts/export",method:"get",params:{eventGraphId:e},responseType:"blob"})}function c(){return(0,a.A)({url:"/api/generated_texts/export/all",method:"get",responseType:"blob"})}function v(e){return(0,a.A)({url:`/generated_texts/${e}/status`,method:"get"})}function p(e,t){return(0,a.A)({url:`/api/generated_texts/${e}`,method:"put",data:t})}},8969:function(e,t,l){l.r(t),l.d(t,{default:function(){return D}});l(8111),l(2489),l(116),l(1701);var a=l(6768),n=l(4232),r=l(144),u=l(1387),s=l(1219),o=l(7477),d=l(8270),i=l(288),c=l(8426);const v={class:"text-generation-create-container"},p={class:"form-area"},k={style:{color:"#8492a6","font-size":"13px","margin-left":"10px"}},m={style:{color:"#8492a6","font-size":"13px","margin-left":"10px"}},h={key:0,class:"preview-section"},y={key:0,class:"preview-card"},f={class:"preview-content"},g={key:1,class:"preview-card"},_={class:"preview-content"},b={key:0,class:"result-section"},I={class:"result-layout"},L={class:"result-area"},x={class:"result-header-with-actions"},C={key:0,class:"result-actions"},A={key:0,class:"result-content"},F={class:"result-header"},X={key:0,class:"result-text",style:{"min-height":"400px",flex:"1","overflow-y":"auto"}},w={key:1,style:{flex:"1",display:"flex","flex-direction":"column",height:"100%"}},E={key:1,class:"result-placeholder"},W={class:"loading-container"},V={key:2,class:"result-placeholder"},G={class:"latest-area"},K={key:0,class:"latest-content"},R={class:"latest-header"},$={class:"latest-text"},q={key:1,class:"latest-placeholder"},z={key:2,class:"latest-placeholder"};var P={__name:"create",setup(e){const t=(0,u.rd)(),l=(0,u.lq)(),P=(0,r.KR)(null),Q=(0,r.KR)(!1),U=(0,r.KR)([]),D=(0,r.KR)([]),T=(0,r.KR)(!1),B=(0,r.KR)(!1),M=(0,r.KR)(!1),N=(0,r.KR)(null),Y=(0,r.KR)(null),j=(0,r.KR)(!1),H=(0,r.KR)(""),S=(0,r.KR)(!1),Z=(0,r.Kh)({eventGraphId:"",styleId:"",modelId:"deepseek",customPrompt:""}),J=(0,a.EW)((()=>N.value&&N.value.content?N.value.content.split("\n").filter((e=>""!==e.trim())):[])),O=(0,a.EW)((()=>Y.value&&Y.value.content?Y.value.content.split("\n").filter((e=>""!==e.trim())):[])),ee={eventGraphId:[{required:!0,message:"请选择事件图",trigger:"change"}],styleId:[{required:!0,message:"请选择文本风格",trigger:"change"}],modelId:[{required:!0,message:"请选择生成模型",trigger:"change"}]},te=(0,a.EW)((()=>Z.eventGraphId?U.value.find((e=>e.id===Z.eventGraphId||e.id===Number(Z.eventGraphId))):null)),le=(0,a.EW)((()=>Z.styleId?D.value.find((e=>e.id===Z.styleId||e.id===Number(Z.styleId))):null)),ae=async()=>{T.value=!0;try{const e=await(0,d.Z$)();e&&Array.isArray(e.data)?U.value=e.data:e&&Array.isArray(e)?U.value=e:s.nk.error("获取事件图列表失败");const t=l.query.eventGraphId;if(t&&U.value.length>0){const e=parseInt(t);Z.eventGraphId=e,re(e)}else U.value.length>0&&(Z.eventGraphId=U.value[0].id,re(U.value[0].id))}catch(e){console.error("获取事件图列表失败:",e),s.nk.error("获取事件图列表失败")}finally{T.value=!1}},ne=async()=>{B.value=!0;try{const e=await(0,i.hs)();e&&Array.isArray(e)?D.value=e.map((e=>({...e,tags:e.tags||[]}))):e&&e.success&&Array.isArray(e.data)?D.value=e.data.map((e=>({...e,tags:e.tags||[]}))):s.nk.error("获取文本风格列表失败")}catch(e){console.error("获取文本风格列表失败:",e),s.nk.error("获取文本风格列表失败")}finally{B.value=!1}},re=async e=>{if(e){M.value=!0;try{const t=await(0,c.U6)(e);t?(Y.value=t,t.style&&t.style.id&&(Z.styleId=t.style.id)):Y.value=null}catch(t){console.error("获取最近生成文本失败:",t),Y.value=null}finally{M.value=!1}}},ue=e=>{re(e)},se=e=>{},oe=()=>{P.value.validate((async e=>{if(e){Q.value=!0,N.value=null;try{const e={eventGraphId:Z.eventGraphId,styleId:Z.styleId,customPrompt:Z.customPrompt};s.nk.info("正在生成文本，请耐心等待1-2分钟...");const t=await(0,c.Db)(e);t?(s.nk.success("文本生成成功"),N.value=t,H.value=t.content,S.value=!0,setTimeout((()=>{const e=document.querySelector(".result-area");e&&e.scrollIntoView({behavior:"smooth"})}),200)):s.nk.error("生成文本失败: 服务器未返回有效数据")}catch(t){console.error("生成文本失败:",t),t.response?s.nk.error(`生成文本失败: ${t.response.status} ${t.response.data?.error||t.response.statusText}`):t.request?s.nk.error("生成文本失败: 服务器无响应，请稍后再试"):s.nk.error(`生成文本失败: ${t.message}`)}finally{Q.value=!1}}}))},de=()=>{j.value=!0},ie=async()=>{try{N.value&&(await(0,c.qV)(N.value.id,{content:H.value}),N.value.content=H.value,s.nk.success("保存成功"),re(Z.eventGraphId),j.value=!1,S.value=!0)}catch(e){console.error("保存失败:",e),s.nk.error("保存失败: "+(e.message||"未知错误"))}},ce=()=>{t.back()};return(0,a.wB)((()=>Z.eventGraphId),(e=>{e?re(e):Y.value=null})),(0,a.sV)((()=>{ae(),ne()})),(e,t)=>{const l=(0,a.g2)("el-option"),u=(0,a.g2)("el-select"),s=(0,a.g2)("el-form-item"),d=(0,a.g2)("el-divider"),i=(0,a.g2)("el-input"),c=(0,a.g2)("el-button"),T=(0,a.g2)("el-form"),B=(0,a.g2)("el-icon"),ae=(0,a.g2)("el-empty"),ne=(0,a.g2)("el-skeleton");return(0,a.uX)(),(0,a.CE)("div",v,[t[25]||(t[25]=(0,a.Lk)("div",{class:"page-header"},[(0,a.Lk)("h2",null,"生成新文本")],-1)),(0,a.Lk)("div",p,[(0,a.bF)(T,{ref_key:"formRef",ref:P,model:Z,rules:ee,"label-width":"100px",class:"generation-form"},{default:(0,a.k6)((()=>[(0,a.bF)(s,{label:"选择事件图",prop:"eventGraphId"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{modelValue:Z.eventGraphId,"onUpdate:modelValue":t[0]||(t[0]=e=>Z.eventGraphId=e),placeholder:"请选择事件图",style:{width:"100%"},onChange:ue,"value-key":"id"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(U.value,(e=>((0,a.uX)(),(0,a.Wv)(l,{key:e.id,label:e.title,value:e.id},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,(0,n.v_)(e.title),1),(0,a.Lk)("span",k,(0,n.v_)(e.description),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(s,{label:"选择风格",prop:"styleId"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{modelValue:Z.styleId,"onUpdate:modelValue":t[1]||(t[1]=e=>Z.styleId=e),placeholder:"请选择文本风格",style:{width:"100%"},onChange:se,"value-key":"id"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(D.value,(e=>((0,a.uX)(),(0,a.Wv)(l,{key:e.id,label:e.name,value:e.id},{default:(0,a.k6)((()=>[(0,a.Lk)("span",null,(0,n.v_)(e.name),1),(0,a.Lk)("span",m,(0,n.v_)(e.description),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(d,null,{default:(0,a.k6)((()=>t[5]||(t[5]=[(0,a.eW)("预览")]))),_:1}),te.value||le.value?((0,a.uX)(),(0,a.CE)("div",h,[te.value?((0,a.uX)(),(0,a.CE)("div",y,[t[8]||(t[8]=(0,a.Lk)("h3",null,"所选事件图",-1)),(0,a.Lk)("div",f,[(0,a.Lk)("p",null,[t[6]||(t[6]=(0,a.Lk)("strong",null,"标题：",-1)),(0,a.eW)((0,n.v_)(te.value.title),1)]),(0,a.Lk)("p",null,[t[7]||(t[7]=(0,a.Lk)("strong",null,"描述：",-1)),(0,a.eW)((0,n.v_)(te.value.description),1)])])])):(0,a.Q3)("",!0),le.value?((0,a.uX)(),(0,a.CE)("div",g,[t[11]||(t[11]=(0,a.Lk)("h3",null,"所选风格",-1)),(0,a.Lk)("div",_,[(0,a.Lk)("p",null,[t[9]||(t[9]=(0,a.Lk)("strong",null,"名称：",-1)),(0,a.eW)((0,n.v_)(le.value.name),1)]),(0,a.Lk)("p",null,[t[10]||(t[10]=(0,a.Lk)("strong",null,"描述：",-1)),(0,a.eW)((0,n.v_)(le.value.description),1)])])])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.bF)(s,{label:"选择模型",prop:"modelId"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{modelValue:Z.modelId,"onUpdate:modelValue":t[2]||(t[2]=e=>Z.modelId=e),placeholder:"请选择生成模型"},{default:(0,a.k6)((()=>[(0,a.bF)(l,{label:"Deepseek-AI",value:"deepseek"}),(0,a.bF)(l,{label:"ChatGLM",value:"chatglm"}),(0,a.bF)(l,{label:"LLaMA",value:"llama"})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(s,{label:"自定义提示"},{default:(0,a.k6)((()=>[(0,a.bF)(i,{type:"textarea",modelValue:Z.customPrompt,"onUpdate:modelValue":t[3]||(t[3]=e=>Z.customPrompt=e),placeholder:"可选：输入对文本生成的特殊要求，如'使用第一人称叙述'、'重点突出某个事件'等",rows:3},null,8,["modelValue"]),t[12]||(t[12]=(0,a.Lk)("div",{class:"form-tip"},"该提示将作为额外指令传给AI模型，帮助您获得更符合需求的生成结果",-1))])),_:1}),(0,a.bF)(s,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,{type:"primary",loading:Q.value,onClick:oe},{default:(0,a.k6)((()=>t[13]||(t[13]=[(0,a.eW)("开始生成")]))),_:1},8,["loading"]),(0,a.bF)(c,{onClick:ce},{default:(0,a.k6)((()=>t[14]||(t[14]=[(0,a.eW)("返回")]))),_:1})])),_:1})])),_:1},8,["model"])]),Z.eventGraphId?((0,a.uX)(),(0,a.CE)("div",b,[(0,a.Lk)("div",I,[(0,a.Lk)("div",L,[(0,a.Lk)("div",x,[t[17]||(t[17]=(0,a.Lk)("h3",null,"生成结果",-1)),N.value?((0,a.uX)(),(0,a.CE)("div",C,[!j.value&&S.value?((0,a.uX)(),(0,a.Wv)(c,{key:0,type:"primary",size:"small",onClick:de},{default:(0,a.k6)((()=>t[15]||(t[15]=[(0,a.eW)("编辑")]))),_:1})):(0,a.Q3)("",!0),j.value?((0,a.uX)(),(0,a.Wv)(c,{key:1,type:"success",size:"small",onClick:ie},{default:(0,a.k6)((()=>t[16]||(t[16]=[(0,a.eW)("保存")]))),_:1})):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)]),N.value?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",F,[(0,a.Lk)("p",null,[t[18]||(t[18]=(0,a.Lk)("strong",null,"标题：",-1)),(0,a.eW)((0,n.v_)(te.value?.title),1)]),(0,a.Lk)("p",null,[t[19]||(t[19]=(0,a.Lk)("strong",null,"生成时间：",-1)),(0,a.eW)((0,n.v_)(N.value.createdAt),1)])]),(0,a.bF)(d),j.value?((0,a.uX)(),(0,a.CE)("div",w,[(0,a.bF)(i,{type:"textarea",modelValue:H.value,"onUpdate:modelValue":t[4]||(t[4]=e=>H.value=e),autosize:{minRows:20},resize:"none",style:{width:"100%",height:"100%"}},null,8,["modelValue"])])):((0,a.uX)(),(0,a.CE)("div",X,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(J.value,((e,t)=>((0,a.uX)(),(0,a.CE)("p",{key:t},(0,n.v_)(e),1)))),128))]))])):Q.value?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("div",W,[(0,a.bF)(B,{class:"loading-icon is-loading"},{default:(0,a.k6)((()=>[(0,a.bF)((0,r.R1)(o.Rhj))])),_:1}),t[20]||(t[20]=(0,a.Lk)("p",{class:"loading-text"},"正在生成文本，请耐心等待...",-1)),t[21]||(t[21]=(0,a.Lk)("p",{class:"loading-tip"},"AI正在思考，这可能需要1-2分钟，请勿关闭页面",-1))])])):((0,a.uX)(),(0,a.CE)("div",V,[(0,a.bF)(ae,{description:'点击"开始生成"按钮生成文本'})]))]),(0,a.Lk)("div",G,[t[24]||(t[24]=(0,a.Lk)("h3",null,"最近生成的文本",-1)),Y.value?((0,a.uX)(),(0,a.CE)("div",K,[(0,a.Lk)("div",R,[(0,a.Lk)("p",null,[t[22]||(t[22]=(0,a.Lk)("strong",null,"风格：",-1)),(0,a.eW)((0,n.v_)(Y.value.style?.name),1)]),(0,a.Lk)("p",null,[t[23]||(t[23]=(0,a.Lk)("strong",null,"生成时间：",-1)),(0,a.eW)((0,n.v_)(Y.value.createdAt),1)])]),(0,a.bF)(d),(0,a.Lk)("div",$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(O.value,((e,t)=>((0,a.uX)(),(0,a.CE)("p",{key:t},(0,n.v_)(e),1)))),128))])])):M.value?((0,a.uX)(),(0,a.CE)("div",q,[(0,a.bF)(ne,{rows:10,animated:""})])):((0,a.uX)(),(0,a.CE)("div",z,[(0,a.bF)(ae,{description:"暂无最近生成的文本"})]))])])])):(0,a.Q3)("",!0)])}}},Q=l(1241);const U=(0,Q.A)(P,[["__scopeId","data-v-41285da2"]]);var D=U}}]);