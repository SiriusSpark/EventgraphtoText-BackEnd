"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[697],{5579:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});a(4114);var n=a(6768),l=a(4232),s=a(144),r=a(1387),u=a(1219),o=a(8426);a(8270);const c={class:"text-generation-detail-container"},i={class:"page-header"},d={class:"header-actions"},v={class:"card-header"},p={class:"info-content"},k={class:"info-item"},f={class:"info-item"},g={class:"info-item"},m={class:"info-item"},h={class:"info-item"},_={key:0,class:"info-item full-width"},L={class:"instruction-content"},y={class:"progress-content"},b={class:"progress-message"},I={class:"card-header"},x={class:"generated-content"},A=["innerHTML"],w={class:"error-content"},W={class:"dialog-footer"};var C={__name:"detail",setup(e){const t=(0,r.lq)(),a=(0,r.rd)(),C=(0,s.KR)(!1),R=(0,s.KR)({id:"",eventGraphId:"",styleId:"",content:"",createdAt:"",updatedAt:"",style:null,status:"已完成",errorMessage:""}),F=(0,s.KR)(0),$=(0,s.KR)("正在准备生成...");let V=null;const X=e=>{switch(e){case"已完成":return"success";case"处理中":return"warning";case"失败":return"danger";default:return"info"}},K=e=>100===e?"完成":`${e}%`,U=(0,n.EW)((()=>R.value.content?R.value.content.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"):"")),D=(0,n.EW)((()=>R.value.eventGraphId?`ID: ${R.value.eventGraphId}`:"未关联事件图")),E=(0,n.EW)((()=>R.value.style&&R.value.style.name?R.value.style.name:R.value.styleId?`风格ID: ${R.value.styleId}`:"未设置风格")),G=async()=>{const e=t.params.id;if(e){C.value=!0;try{const t=await(0,o.A_)(e);if(console.log("生成文本详情响应:",t),t){const e=t.data||t;R.value={...R.value,...e,title:e.title||`文本ID: ${e.id}`,status:e.status||"已完成"},console.log("解析后的文本信息:",R.value)}else u.nk.error("获取生成文本详情失败");"处理中"===R.value.status&&M()}catch(a){console.error("获取生成文本详情失败:",a),u.nk.error("获取生成文本详情失败")}finally{C.value=!1}}},M=()=>{V&&clearInterval(V),F.value=10,$.value="正在分析事件图...",V=setInterval((async()=>{try{const e=await(0,o.$R)(R.value.id);if(e&&(e.success||e.status)){const t=e.data||e;t.progress&&(F.value=t.progress),t.message&&($.value=t.message),"已完成"===t.status||F.value>=100?(clearInterval(V),F.value=100,$.value="生成完成，准备显示结果...",await G()):"失败"===t.status&&(clearInterval(V),R.value.status="失败",R.value.errorMessage=t.errorMessage||"生成过程中发生错误")}}catch(e){console.error("获取生成状态失败:",e)}}),3e3)},T=()=>{R.value.content&&navigator.clipboard.writeText(R.value.content).then((()=>{u.nk.success("已复制到剪贴板")})).catch((e=>{console.error("复制失败:",e),u.nk.error("复制失败")}))},Q=()=>{if(!R.value.content)return;const e=new Blob([R.value.content],{type:"text/plain"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`${R.value.title}.txt`,a.click(),URL.revokeObjectURL(t),u.nk.success("文档下载中")},q=()=>{u.nk.success("已重新提交生成任务"),R.value.status="处理中",M()},z=()=>{const{from:e,graphId:n}=t.query;"records"===e&&n?a.push(`/text-generation/records/${n}`):a.push("/text-generation/list")},H=(0,s.KR)(!1),j=(0,s.KR)(!1),N=(0,s.KR)({content:""}),O=()=>{N.value.content=R.value.content||"",H.value=!0},P=async()=>{if(N.value.content.trim()){j.value=!0;try{const e=await(0,o.qV)(R.value.id,{content:N.value.content});console.log("更新文本响应:",e),e&&(e.success||e.id)?(u.nk.success("文本更新成功"),R.value.content=N.value.content,e.updatedAt&&(R.value.updatedAt=e.updatedAt),H.value=!1):u.nk.error(e?.message||e?.error||"更新文本失败")}catch(e){console.error("更新文本失败:",e),u.nk.error("更新文本失败")}finally{j.value=!1}}else u.nk.warning("文本内容不能为空")};return(0,n.sV)((()=>{G()})),(0,n.hi)((()=>{V&&clearInterval(V)})),(e,t)=>{const a=(0,n.g2)("el-button"),s=(0,n.g2)("el-tag"),r=(0,n.g2)("el-card"),u=(0,n.g2)("el-progress"),o=(0,n.g2)("el-input"),V=(0,n.g2)("el-form-item"),G=(0,n.g2)("el-form"),M=(0,n.g2)("el-dialog"),B=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",c,[(0,n.Lk)("div",i,[(0,n.Lk)("h2",null,(0,l.v_)(R.value.title),1),(0,n.Lk)("div",d,[R.value.content?((0,n.uX)(),(0,n.Wv)(a,{key:0,type:"primary",onClick:O},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.eW)("编辑")]))),_:1})):(0,n.Q3)("",!0),(0,n.bF)(a,{onClick:z},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("返回列表")]))),_:1})])]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(r,{class:"info-card"},{header:(0,n.k6)((()=>[(0,n.Lk)("div",v,[t[5]||(t[5]=(0,n.Lk)("span",null,"基本信息",-1)),(0,n.bF)(s,{type:X(R.value.status)},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(R.value.status),1)])),_:1},8,["type"])])])),default:(0,n.k6)((()=>[(0,n.Lk)("div",p,[(0,n.Lk)("div",k,[t[6]||(t[6]=(0,n.Lk)("span",{class:"info-label"},"事件图：",-1)),(0,n.Lk)("span",null,(0,l.v_)(D.value),1)]),(0,n.Lk)("div",f,[t[7]||(t[7]=(0,n.Lk)("span",{class:"info-label"},"文本风格：",-1)),(0,n.Lk)("span",null,(0,l.v_)(E.value),1)]),(0,n.Lk)("div",g,[t[8]||(t[8]=(0,n.Lk)("span",{class:"info-label"},"生成模型：",-1)),(0,n.Lk)("span",null,(0,l.v_)(R.value.modelName),1)]),(0,n.Lk)("div",m,[t[9]||(t[9]=(0,n.Lk)("span",{class:"info-label"},"创建时间：",-1)),(0,n.Lk)("span",null,(0,l.v_)(R.value.createdAt),1)]),(0,n.Lk)("div",h,[t[10]||(t[10]=(0,n.Lk)("span",{class:"info-label"},"完成时间：",-1)),(0,n.Lk)("span",null,(0,l.v_)(R.value.updatedAt||"-"),1)]),R.value.additionalInstructions?((0,n.uX)(),(0,n.CE)("div",_,[t[11]||(t[11]=(0,n.Lk)("span",{class:"info-label"},"额外指令：",-1)),(0,n.Lk)("div",L,(0,l.v_)(R.value.additionalInstructions),1)])):(0,n.Q3)("",!0)])])),_:1})),[[B,C.value]]),"处理中"===R.value.status?((0,n.uX)(),(0,n.Wv)(r,{key:0,class:"progress-card"},{header:(0,n.k6)((()=>t[12]||(t[12]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"生成进度")],-1)]))),default:(0,n.k6)((()=>[(0,n.Lk)("div",y,[(0,n.bF)(u,{percentage:F.value,format:K},null,8,["percentage"]),(0,n.Lk)("p",b,(0,l.v_)($.value),1)])])),_:1})):(0,n.Q3)("",!0),R.value.content?((0,n.uX)(),(0,n.Wv)(r,{key:1,class:"content-card"},{header:(0,n.k6)((()=>[(0,n.Lk)("div",I,[t[15]||(t[15]=(0,n.Lk)("span",null,"生成内容",-1)),(0,n.Lk)("div",null,[(0,n.bF)(a,{type:"primary",size:"small",onClick:T},{default:(0,n.k6)((()=>t[13]||(t[13]=[(0,n.eW)("复制全文")]))),_:1}),(0,n.bF)(a,{type:"success",size:"small",onClick:Q},{default:(0,n.k6)((()=>t[14]||(t[14]=[(0,n.eW)("下载文档")]))),_:1})])])])),default:(0,n.k6)((()=>[(0,n.Lk)("div",x,[(0,n.Lk)("div",{innerHTML:U.value},null,8,A)])])),_:1})):(0,n.Q3)("",!0),"失败"===R.value.status?((0,n.uX)(),(0,n.Wv)(r,{key:2,class:"error-card"},{header:(0,n.k6)((()=>t[16]||(t[16]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("span",null,"错误信息")],-1)]))),default:(0,n.k6)((()=>[(0,n.Lk)("div",w,[(0,n.Lk)("p",null,(0,l.v_)(R.value.errorMessage||"生成过程中发生未知错误，请稍后重试。"),1),(0,n.bF)(a,{type:"primary",onClick:q},{default:(0,n.k6)((()=>t[17]||(t[17]=[(0,n.eW)("重新生成")]))),_:1})])])),_:1})):(0,n.Q3)("",!0),(0,n.bF)(M,{modelValue:H.value,"onUpdate:modelValue":t[2]||(t[2]=e=>H.value=e),title:"编辑文本内容",width:"70%"},{footer:(0,n.k6)((()=>[(0,n.Lk)("span",W,[(0,n.bF)(a,{onClick:t[1]||(t[1]=e=>H.value=!1)},{default:(0,n.k6)((()=>t[18]||(t[18]=[(0,n.eW)("取消")]))),_:1}),(0,n.bF)(a,{type:"primary",onClick:P,loading:j.value},{default:(0,n.k6)((()=>t[19]||(t[19]=[(0,n.eW)("确定")]))),_:1},8,["loading"])])])),default:(0,n.k6)((()=>[(0,n.bF)(G,{model:N.value},{default:(0,n.k6)((()=>[(0,n.bF)(V,null,{default:(0,n.k6)((()=>[(0,n.bF)(o,{modelValue:N.value.content,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value.content=e),type:"textarea",rows:15,placeholder:"请输入文本内容"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},R=a(1241);const F=(0,R.A)(C,[["__scopeId","data-v-509bb1f2"]]);var $=F},8426:function(e,t,a){a.d(t,{$R:function(){return v},A_:function(){return s},Db:function(){return r},PH:function(){return i},U6:function(){return u},Vy:function(){return l},Xi:function(){return d},Yz:function(){return c},gL:function(){return o},qV:function(){return p}});var n=a(5720);function l(){return(0,n.A)({url:"/api/generated_texts/all",method:"get",params:{_t:(new Date).getTime()},headers:{"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}})}function s(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"get"})}function r(e){return(0,n.A)({url:"/api/generated_texts",method:"post",data:e})}function u(e){return(0,n.A)({url:"/api/generated_texts/latest",method:"get",params:{eventGraphId:e}})}function o(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"delete"})}function c(e){return console.log("开始请求事件图生成记录，事件图ID:",e),(0,n.A)({url:"/api/generated_texts",method:"get",params:{eventGraphId:e}})}function i(e){return(0,n.A)({url:"/api/generated_texts/export",method:"get",params:{eventGraphId:e},responseType:"blob"})}function d(){return(0,n.A)({url:"/api/generated_texts/export/all",method:"get",responseType:"blob"})}function v(e){return(0,n.A)({url:`/generated_texts/${e}/status`,method:"get"})}function p(e,t){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"put",data:t})}}}]);