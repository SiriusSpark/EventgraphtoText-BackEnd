"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[847],{847:function(a,e,l){l.r(e),l.d(e,{default:function(){return P}});var r=l(6768),s=l(4232),t=l(144),n=l(4249),u=l(1219),o=l(7477),i=l(2549),c=l(5720);const d={class:"profile-container"},v={class:"profile-content"},m={class:"avatar-section"},k={class:"info-container"},p={class:"info-item"},f={class:"info-value"},_={class:"info-item"},b={class:"info-value"},g={class:"info-item"},L={class:"info-value"},y={class:"info-item"},h={class:"info-value"},F={class:"info-item"},V={class:"info-value"},w={class:"edit-button-container"},R=["src"],C={class:"dialog-footer"},W="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",K="http://localhost:8080";var x={__name:"Profile",setup(a){const e=(0,n.Pj)(),l=a=>{if(!a)return W;const e=(0,c.o)(a);return e.startsWith("http")?e:`${K}${e}`},x=(0,t.KR)({id:null,username:"",nickname:"",email:"",avatar_url:"",created_at:"",last_active_at:""}),E=(0,r.EW)((()=>l(x.value.avatar_url))),U=(0,t.KR)(!0),P=(0,t.KR)(!1),j=(0,t.KR)(!1),X=(0,t.KR)(null),G=(0,t.Kh)({username:"",nickname:"",email:"",avatar_url:""}),z={nickname:[{max:50,message:"昵称长度不能超过50个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},A=async()=>{U.value=!0;try{const a=await(0,i.HW)();a.success&&a.data?x.value=a.data:u.nk.error("获取用户信息失败")}catch(a){console.error("获取用户信息失败:",a),u.nk.error("获取用户信息失败")}finally{U.value=!1}},I=()=>{Object.assign(G,{username:x.value.username,nickname:x.value.nickname,email:x.value.email,avatar_url:x.value.avatar_url}),j.value=!0},N=a=>{const e="image/jpeg"===a.type||"image/png"===a.type,l=a.size/1024/1024<2;return e||u.nk.error("头像只能是JPG或PNG格式!"),l||u.nk.error("头像大小不能超过2MB!"),e&&l},S=async a=>{const{file:e}=a;try{const a=await(0,i.xG)(x.value.id,e);console.log("头像上传API响应:",a),a&&"object"===typeof a?a.success&&a.data&&a.data.avatar_url||a.data&&a.data.avatar_url?(G.avatar_url=a.data.avatar_url,u.nk.success("头像上传成功")):a.avatar_url?(G.avatar_url=a.avatar_url,u.nk.success("头像上传成功")):(console.error("无法从响应中提取头像URL:",a),u.nk.error("头像上传失败: 无法解析响应数据")):(console.error("无效的响应格式:",a),u.nk.error("头像上传失败: 无效的响应格式"))}catch(l){console.error("头像上传失败:",l),u.nk.error(l.response?.data?.message||"头像上传失败")}},T=async()=>{X.value&&await X.value.validate((async a=>{if(a){P.value=!0;try{const a=await(0,i.TK)(x.value.id,{nickname:G.nickname,email:G.email,avatar_url:G.avatar_url});a.success?(u.nk.success("保存成功"),j.value=!1,A(),e.commit("SET_USER",{...e.state.user,nickname:G.nickname,email:G.email,avatar_url:G.avatar_url})):u.nk.error(a.message||"保存失败")}catch(l){console.error("保存用户信息失败:",l),u.nk.error("保存失败")}finally{P.value=!1}}}))};return(0,r.sV)((()=>{A()})),(a,e)=>{const n=(0,r.g2)("el-avatar"),u=(0,r.g2)("el-button"),i=(0,r.g2)("el-card"),c=(0,r.g2)("el-input"),W=(0,r.g2)("el-form-item"),K=(0,r.g2)("el-icon"),A=(0,r.g2)("el-upload"),$=(0,r.g2)("el-form"),q=(0,r.g2)("el-dialog"),B=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(i,{class:"profile-card"},{header:(0,r.k6)((()=>e[5]||(e[5]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"个人信息")],-1)]))),default:(0,r.k6)((()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",v,[(0,r.Lk)("div",m,[(0,r.bF)(n,{size:150,src:E.value},null,8,["src"])]),(0,r.Lk)("div",k,[(0,r.Lk)("div",p,[e[6]||(e[6]=(0,r.Lk)("span",{class:"info-label"},"用户名：",-1)),(0,r.Lk)("span",f,(0,s.v_)(x.value.username),1)]),(0,r.Lk)("div",_,[e[7]||(e[7]=(0,r.Lk)("span",{class:"info-label"},"昵称：",-1)),(0,r.Lk)("span",b,(0,s.v_)(x.value.nickname||"未设置"),1)]),(0,r.Lk)("div",g,[e[8]||(e[8]=(0,r.Lk)("span",{class:"info-label"},"邮箱：",-1)),(0,r.Lk)("span",L,(0,s.v_)(x.value.email||"未设置"),1)]),(0,r.Lk)("div",y,[e[9]||(e[9]=(0,r.Lk)("span",{class:"info-label"},"注册时间：",-1)),(0,r.Lk)("span",h,(0,s.v_)(x.value.created_at||"未知"),1)]),(0,r.Lk)("div",F,[e[10]||(e[10]=(0,r.Lk)("span",{class:"info-label"},"最近活动：",-1)),(0,r.Lk)("span",V,(0,s.v_)(x.value.last_active_at||"未知"),1)]),(0,r.Lk)("div",w,[(0,r.bF)(u,{type:"primary",onClick:I},{default:(0,r.k6)((()=>e[11]||(e[11]=[(0,r.eW)("编辑")]))),_:1})])])])),[[B,U.value]])])),_:1}),(0,r.bF)(q,{modelValue:j.value,"onUpdate:modelValue":e[4]||(e[4]=a=>j.value=a),title:"编辑个人信息",width:"500px"},{footer:(0,r.k6)((()=>[(0,r.Lk)("span",C,[(0,r.bF)(u,{onClick:e[3]||(e[3]=a=>j.value=!1)},{default:(0,r.k6)((()=>e[13]||(e[13]=[(0,r.eW)("取消")]))),_:1}),(0,r.bF)(u,{type:"primary",onClick:T,loading:P.value},{default:(0,r.k6)((()=>e[14]||(e[14]=[(0,r.eW)(" 保存 ")]))),_:1},8,["loading"])])])),default:(0,r.k6)((()=>[(0,r.bF)($,{model:G,"label-width":"100px",rules:z,ref_key:"editFormRef",ref:X},{default:(0,r.k6)((()=>[(0,r.bF)(W,{label:"用户名",prop:"username"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{modelValue:G.username,"onUpdate:modelValue":e[0]||(e[0]=a=>G.username=a),disabled:""},null,8,["modelValue"])])),_:1}),(0,r.bF)(W,{label:"昵称",prop:"nickname"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{modelValue:G.nickname,"onUpdate:modelValue":e[1]||(e[1]=a=>G.nickname=a),placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),(0,r.bF)(W,{label:"邮箱",prop:"email"},{default:(0,r.k6)((()=>[(0,r.bF)(c,{modelValue:G.email,"onUpdate:modelValue":e[2]||(e[2]=a=>G.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),(0,r.bF)(W,{label:"头像"},{default:(0,r.k6)((()=>[(0,r.bF)(A,{class:"avatar-uploader","show-file-list":!1,"before-upload":N,"http-request":S},{default:(0,r.k6)((()=>[G.avatar_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:l(G.avatar_url),class:"avatar-preview"},null,8,R)):((0,r.uX)(),(0,r.Wv)(K,{key:1,class:"avatar-uploader-icon"},{default:(0,r.k6)((()=>[(0,r.bF)((0,t.R1)(o.FWt))])),_:1})),e[12]||(e[12]=(0,r.Lk)("div",{class:"upload-tip"},"点击上传新头像",-1))])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},E=l(1241);const U=(0,E.A)(x,[["__scopeId","data-v-b5eb2e2a"]]);var P=U}}]);