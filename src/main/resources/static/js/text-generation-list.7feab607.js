"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[258],{4649:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});n(4114),n(8111),n(2489),n(1701),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var r=n(6768),a=n(4232),o=n(144),l=n(1387),s=n(1219),c=n(8426),u=n(8270);const i={class:"text-generation-list-container"},d={class:"table-header"},p={class:"right-section"},v={class:"records-container"},f={key:1,class:"card-container"},g={class:"card-header"},h={class:"meta-info"},k={class:"style-info"},y={class:"time"},m={class:"card-content"},_={class:"text-content"},b={class:"card-footer"};var L={__name:"list",setup(e){const t=(0,l.rd)(),n=(0,o.KR)(!1),L=(0,o.KR)(!1),x=(0,o.KR)([]),C=(0,o.KR)(""),I=(0,o.KR)({}),w=(0,r.EW)((()=>{if(!C.value)return x.value;const e=C.value.toLowerCase();return x.value.filter((t=>{const n=t.content&&t.content.toLowerCase().includes(e),r=t.style&&t.style.name&&t.style.name.toLowerCase().includes(e),a=t.id&&t.id.toString().includes(e),o=I.value[t.eventGraphId]?.title||"",l=o.toLowerCase().includes(e);return n||r||a||l}))})),A=e=>{if(!e.eventGraphId)return`文本ID: ${e.id}`;const t=I.value[e.eventGraphId];return t&&t.title?t.title:`事件图ID: ${e.eventGraphId}`},R=()=>{console.log("搜索关键词:",C.value)},W=async e=>{try{if(I.value[e])return;const t=await(0,u.aR)(e);t&&t.success&&t.data&&(I.value[e]=t.data)}catch(t){console.error(`获取事件图详情失败，ID: ${e}`,t)}},X=async()=>{n.value=!0;try{const e=await(0,c.Vy)();if(console.log("获取到的生成记录:",e),Array.isArray(e)?x.value=e:e&&e.success&&Array.isArray(e.data)?x.value=e.data:(x.value=[],e&&(e.message||e.error)&&s.nk.error(e.message||e.error)),0===x.value.length)console.log("没有找到生成记录");else{const e=[...new Set(x.value.filter((e=>e.eventGraphId)).map((e=>e.eventGraphId)))];for(const t of e)await W(t)}}catch(e){console.error("获取生成记录失败:",e),s.nk.error("获取生成记录失败"),x.value=[]}finally{n.value=!1}},$=async()=>{if(0!==x.value.length){L.value=!0;try{const e=await(0,c.Xi)(),t=new Blob([e],{type:"application/zip"}),n=document.createElement("a");n.href=URL.createObjectURL(t);const r=(new Date).toISOString().slice(0,10),a=`全部文本_${r}.zip`;n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href),s.nk.success("导出成功")}catch(e){console.error("导出文本失败:",e),s.nk.error("导出文本失败，请稍后重试")}finally{L.value=!1}}else s.nk.warning("暂无文本可导出")},G=()=>{t.push("/text-generation/create")},D=e=>{t.push(`/text-generation/detail/${e}`)},F=async e=>{try{const t=await(0,c.gL)(e);t&&(t.success||t.id||200===t.status)?(s.nk.success("删除成功"),await X()):s.nk.error(t?.message||t?.error||"删除失败")}catch(t){console.error("删除生成文本失败:",t),s.nk.error("删除生成文本失败")}};return(0,r.sV)((()=>{X()})),(e,t)=>{const o=(0,r.g2)("el-input"),l=(0,r.g2)("el-button"),s=(0,r.g2)("el-empty"),c=(0,r.g2)("el-tag"),u=(0,r.g2)("el-popconfirm"),x=(0,r.g2)("el-card"),I=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",d,[t[3]||(t[3]=(0,r.Lk)("h2",null,"全部记录",-1)),(0,r.Lk)("div",p,[(0,r.bF)(o,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),placeholder:"搜索文本内容","prefix-icon":"Search",clearable:"",onInput:R,class:"search-input"},null,8,["modelValue"]),(0,r.bF)(l,{type:"success",onClick:$,loading:L.value},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("全部导出")]))),_:1},8,["loading"]),(0,r.bF)(l,{type:"primary",onClick:G},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("生成新文本")]))),_:1})])]),(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",v,[0===w.value.length?((0,r.uX)(),(0,r.Wv)(s,{key:0,description:"暂无生成记录"})):((0,r.uX)(),(0,r.CE)("div",f,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(w.value,(e=>((0,r.uX)(),(0,r.Wv)(x,{key:e.id,class:"text-card"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",g,[(0,r.Lk)("h3",null,(0,a.v_)(A(e)),1),(0,r.Lk)("div",h,[(0,r.Lk)("div",k,[e.style?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"success"},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.style.name),1)])),_:2},1024)):((0,r.uX)(),(0,r.Wv)(c,{key:1},{default:(0,r.k6)((()=>[(0,r.eW)("风格ID: "+(0,a.v_)(e.styleId),1)])),_:2},1024))]),(0,r.Lk)("span",y,"创建时间: "+(0,a.v_)(e.createdAt),1)])]),(0,r.Lk)("div",m,[(0,r.Lk)("div",_,(0,a.v_)(e.content),1)]),(0,r.Lk)("div",b,[(0,r.bF)(l,{type:"primary",link:"",onClick:t=>D(e.id)},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)("查看详情")]))),_:2},1032,["onClick"]),(0,r.bF)(u,{title:"确定删除此记录?",onConfirm:t=>F(e.id)},{reference:(0,r.k6)((()=>[(0,r.bF)(l,{type:"danger",link:""},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])])])),_:2},1024)))),128))]))])),[[I,n.value]])])}}},x=n(1241);const C=(0,x.A)(L,[["__scopeId","data-v-01a8f864"]]);var I=C},8426:function(e,t,n){n.d(t,{$R:function(){return p},A_:function(){return o},Db:function(){return l},PH:function(){return i},U6:function(){return s},Vy:function(){return a},Xi:function(){return d},Yz:function(){return u},gL:function(){return c},qV:function(){return v}});var r=n(5720);function a(){return(0,r.A)({url:"/api/generated_texts/all",method:"get",params:{_t:(new Date).getTime()},headers:{"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}})}function o(e){return(0,r.A)({url:`/api/generated_texts/${e}`,method:"get"})}function l(e){return(0,r.A)({url:"/api/generated_texts",method:"post",data:e})}function s(e){return(0,r.A)({url:"/api/generated_texts/latest",method:"get",params:{eventGraphId:e}})}function c(e){return(0,r.A)({url:`/api/generated_texts/${e}`,method:"delete"})}function u(e){return console.log("开始请求事件图生成记录，事件图ID:",e),(0,r.A)({url:"/api/generated_texts",method:"get",params:{eventGraphId:e}})}function i(e){return(0,r.A)({url:"/api/generated_texts/export",method:"get",params:{eventGraphId:e},responseType:"blob"})}function d(){return(0,r.A)({url:"/api/generated_texts/export/all",method:"get",responseType:"blob"})}function p(e){return(0,r.A)({url:`/generated_texts/${e}/status`,method:"get"})}function v(e,t){return(0,r.A)({url:`/api/generated_texts/${e}`,method:"put",data:t})}}}]);