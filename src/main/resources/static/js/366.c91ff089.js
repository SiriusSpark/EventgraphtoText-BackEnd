"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[366],{4366:function(t,e,a){a.r(e),a.d(e,{default:function(){return U}});a(4114),a(8111),a(1701);var s=a(6768),r=a(144),l=a(4232),n=a(7477),d=a(3464),i=a(8270),c=a(5720);function o(){return(0,c.A)({url:"/api/statistics/system",method:"get"})}var u=a(1219),v=a(1387);const p={class:"dashboard-container"},k={class:"dashboard-left"},f={class:"dashboard-stats"},g={class:"stat-icon"},h={class:"stat-info"},y={class:"stat-value"},L={class:"stat-icon"},E={class:"stat-info"},b={class:"stat-value"},_={class:"stat-icon"},S={class:"stat-info"},C={class:"stat-value"},x={class:"stat-icon"},F={class:"stat-info"},R={class:"stat-value"},m={class:"dashboard-visualize"},A={class:"card-header"},I={class:"visualization-container"},T=1;var O={__name:"Home",setup(t){const e=(0,v.rd)(),a=(0,r.KR)(0),c=(0,r.KR)(0),O=(0,r.KR)(0),w=(0,r.KR)(0),$=(0,r.KR)(!1),U=(0,r.KR)(null),N=(0,r.KR)({title:"事件图示例",description:"首页展示的事件图示例",nodes:[],edges:[]}),W={PRECEDES:"#4285F4",FOLLOWS:"#34A853",CONCURRENT_WITH:"#8F44AD",CAUSES:"#EA4335",RESULTS_IN:"#FBBC05",COREFERS_TO:"#00ACC1",HAS_SUBEVENT:"#FF5722",SUBEVENT_OF:"#795548"},B=t=>{const e={PRECEDES:"先于",FOLLOWS:"后于",CONCURRENT_WITH:"同时",CAUSES:"导致",RESULTS_IN:"结果",COREFERS_TO:"共指",HAS_SUBEVENT:"包含子事件",SUBEVENT_OF:"属于"};return e[t]||t},H=async()=>{try{const t=await o();t&&t.success&&t.data?(a.value=t.data.userCount,c.value=t.data.eventGraphCount,O.value=t.data.textStyleCount,w.value=t.data.generatedTextCount):console.error("获取统计数据失败:",t?.message||"未知错误")}catch(t){console.error("获取统计数据失败:",t)}},K=async()=>{$.value=!0;try{console.log("获取示例事件图:",T);const t=await(0,i.kW)(T);t&&t.success&&t.data?(N.value=t.data,await(0,s.dY)(),z()):(console.error("获取示例事件图失败:",t?.message||"未知错误"),M())}catch(t){console.error("获取示例事件图失败:",t),M()}finally{$.value=!1}},M=()=>{N.value={title:"示例事件图",description:"模拟的事件图数据",nodes:[{id:1,title:"东晋建立",type:"event"},{id:2,title:"淝水之战",type:"event"},{id:3,title:"谢安之计",type:"event"},{id:4,title:"刘裕称帝",type:"event"},{id:5,title:"八王之乱",type:"event"},{id:6,title:"西晋建立",type:"event"}],edges:[{id:1,sourceId:1,targetId:2,type:"PRECEDES",label:"先于"},{id:2,sourceId:3,targetId:2,type:"CAUSES",label:"导致",strength:"中"},{id:3,sourceId:5,targetId:1,type:"CAUSES",label:"导致",strength:"强"},{id:4,sourceId:6,targetId:5,type:"PRECEDES",label:"先于"},{id:5,sourceId:5,targetId:8,type:"FOLLOWS",label:"后于"}]},z()},z=()=>{if(!U.value)return;d.Ltv(U.value).selectAll("*").remove();const t=N.value.nodes||[],e=(N.value.edges||[]).map((t=>({id:t.id,source:t.sourceId,target:t.targetId,type:t.type,strength:t.strength})));t.length?(0,s.dY)((()=>{const a=U.value.clientWidth||800,s=U.value.clientHeight||600;console.log("图表容器尺寸:",a,"x",s);const r=d.Ltv(U.value).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,a,s]).attr("style","position: absolute; top: 0; left: 0; width: 100%; height: 100%;");r.append("defs").selectAll("marker").data(Object.keys(W)).enter().append("marker").attr("id",(t=>`arrow-${t}`)).attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill",(t=>W[t])).attr("d","M0,-5L10,0L0,5");const l=r.append("g"),n=d.s_O().scaleExtent([.1,4]).on("zoom",(t=>{l.attr("transform",t.transform)}));r.call(n);const i=d.tXi(t).force("link",d.kJC(e).id((t=>t.id)).distance(150)).force("charge",d.xJS().strength(-400)).force("center",d.jTM(a/2,s/2)).force("collision",d.eRw().radius(50)),c=l.append("g").attr("stroke-opacity",.6).selectAll("g").data(e).enter().append("g");c.append("path").attr("stroke",(t=>W[t.type]||"#999")).attr("stroke-width",2).attr("fill","none").attr("marker-end",(t=>`url(#arrow-${t.type})`)).attr("id",(t=>`link-${t.id}`)),c.append("text").attr("dy",-5).attr("text-anchor","middle").attr("fill","#666").append("textPath").attr("xlink:href",(t=>`#link-${t.id}`)).attr("startOffset","50%").text((t=>{let e=B(t.type);return"CAUSES"!==t.type&&"RESULTS_IN"!==t.type||(e+=t.strength?`(${t.strength})`:""),e}));const o=l.append("g").selectAll(".node").data(t).enter().append("g").attr("class","node").call(d.$Er().on("start",u).on("drag",v).on("end",p));function u(t,e){t.active||i.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function v(t,e){e.fx=t.x,e.fy=t.y}function p(t,e){t.active||i.alphaTarget(0),e.fx=null,e.fy=null}o.append("circle").attr("r",30).attr("fill","#39c5bb").attr("stroke","#2a9d8f").attr("stroke-width",2),o.append("text").attr("text-anchor","middle").attr("fill","#fff").attr("dy",".3em").text((t=>t.title)),o.append("title").text((t=>`${t.title}\n${t.description||""}`)),i.on("tick",(()=>{c.select("path").attr("d",(t=>{const e=t.target.x-t.source.x,a=t.target.y-t.source.y,s=Math.sqrt(e*e+a*a);if(0===s)return"M0,0L0,0";const r=30,l=s||1,n=e*r/l,d=a*r/l,i=t.target.x-n,c=t.target.y-d;return`M${t.source.x},${t.source.y}L${i},${c}`})),o.attr("transform",(t=>`translate(${t.x},${t.y})`))}))})):console.error("没有节点数据")},D=async()=>{try{const t=await(0,i.Z$)();let a=[];if(t&&Array.isArray(t)?a=t:t&&t.success&&Array.isArray(t.data)&&(a=t.data),a.length>0){const t=[...a].sort(((t,e)=>t.id-e.id))[0];e.push(`/event-graph/visualize/${t.id}`)}else u.nk.warning("没有可查看的事件图"),e.push("/event-graph/list")}catch(t){console.error("获取事件图列表失败:",t),u.nk.error("获取事件图列表失败"),e.push("/event-graph/list")}};return(0,s.sV)((()=>{H(),K()})),(t,e)=>{const d=(0,s.g2)("el-icon"),i=(0,s.g2)("el-card"),o=(0,s.g2)("el-button"),u=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",k,[e[4]||(e[4]=(0,s.Lk)("div",{class:"dashboard-header"},[(0,s.Lk)("h1",{class:"system-title"},"基于事件图的文本生成系统")],-1)),(0,s.Lk)("div",f,[(0,s.bF)(i,{class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",g,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,r.R1)(n.eHG))])),_:1})]),(0,s.Lk)("div",h,[(0,s.Lk)("div",y,(0,l.v_)(a.value),1),e[0]||(e[0]=(0,s.Lk)("div",{class:"stat-label"},"用户总数",-1))])])),_:1}),(0,s.bF)(i,{class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",L,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,r.R1)(n.SYj))])),_:1})]),(0,s.Lk)("div",E,[(0,s.Lk)("div",b,(0,l.v_)(c.value),1),e[1]||(e[1]=(0,s.Lk)("div",{class:"stat-label"},"事件图总数",-1))])])),_:1}),(0,s.bF)(i,{class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",_,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,r.R1)(n.vMd))])),_:1})]),(0,s.Lk)("div",S,[(0,s.Lk)("div",C,(0,l.v_)(O.value),1),e[2]||(e[2]=(0,s.Lk)("div",{class:"stat-label"},"文本风格总数",-1))])])),_:1}),(0,s.bF)(i,{class:"stat-card"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",x,[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,r.R1)(n.yoT))])),_:1})]),(0,s.Lk)("div",F,[(0,s.Lk)("div",R,(0,l.v_)(w.value),1),e[3]||(e[3]=(0,s.Lk)("div",{class:"stat-label"},"生成文本总数",-1))])])),_:1})])]),(0,s.Lk)("div",m,[(0,s.bF)(i,{class:"visualize-card"},{header:(0,s.k6)((()=>[(0,s.Lk)("div",A,[e[6]||(e[6]=(0,s.Lk)("span",null,"事件图示例",-1)),(0,s.bF)(o,{link:"",onClick:D},{default:(0,s.k6)((()=>e[5]||(e[5]=[(0,s.eW)("查看更多")]))),_:1})])])),default:(0,s.k6)((()=>[(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",I,[(0,s.bF)(i,{class:"legend"},{default:(0,s.k6)((()=>[e[7]||(e[7]=(0,s.Lk)("h3",null,"关系类型",-1)),((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(W,((t,e)=>(0,s.Lk)("div",{key:e,class:"legend-item"},[(0,s.Lk)("div",{class:"color-dot",style:(0,l.Tr)({backgroundColor:t})},null,4),(0,s.Lk)("span",null,(0,l.v_)(B(e)),1)]))),64))])),_:1}),(0,s.Lk)("div",{id:"graph-container",ref_key:"graphContainer",ref:U},null,512)])),[[u,$.value]])])),_:1})])])}}},w=a(1241);const $=(0,w.A)(O,[["__scopeId","data-v-2b30d640"]]);var U=$}}]);