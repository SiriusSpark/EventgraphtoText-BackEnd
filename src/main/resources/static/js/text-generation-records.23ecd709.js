"use strict";(self["webpackChunktext_generation_system"]=self["webpackChunktext_generation_system"]||[]).push([[4],{4534:function(e,t,a){a.r(t),a.d(t,{default:function(){return W}});a(4114);var n=a(6768),r=a(4232),l=a(144),o=a(1387),s=a(1219),u=a(164),c=a(8426),i=a(8270),d=a(7477);const v={class:"text-generation-records"},p={class:"header"},g={key:0,class:"description"},y={class:"header-buttons"},k={class:"content-wrapper"},f={class:"content"},h={key:1,class:"card-container"},m={class:"card-header"},_={class:"meta-info"},b={class:"style-info"},A={class:"time"},x={class:"card-content"},C={class:"text-content"},L={class:"card-footer"};var w={__name:"records",setup(e){const t=(0,o.rd)(),a=(0,o.lq)(),w=(0,l.KR)(!1),I=(0,l.KR)(!1),R=(0,l.KR)([]),W=(0,l.KR)(null),$=a.params.id,X=(0,l.KR)([]),D=(0,l.KR)(-1),E=(0,n.EW)((()=>D.value>0)),z=(0,n.EW)((()=>D.value<X.value.length-1&&D.value>=0)),F=e=>e||"",K=async()=>{try{const e=await(0,i.Z$)();e&&Array.isArray(e)?X.value=e.sort(((e,t)=>e.id-t.id)):e&&e.success&&Array.isArray(e.data)?X.value=e.data.sort(((e,t)=>e.id-t.id)):(console.error("获取事件图列表失败"),X.value=[]),$&&(D.value=X.value.findIndex((e=>e.id==$)))}catch(e){console.error("获取事件图列表失败:",e),s.nk.error("获取事件图列表失败"),X.value=[]}},T=e=>{let a=-1;if("prev"===e&&E.value?a=D.value-1:"next"===e&&z.value&&(a=D.value+1),a>=0&&a<X.value.length){const e=X.value[a];w.value=!0,t.push(`/text-generation/records/${e.id}`).then((()=>{G(e.id).then((()=>{D.value=a}))}))}},U=async()=>{console.log("开始重新获取生成记录..."),w.value=!0;try{const e=await(0,c.Yz)($);console.log("获取到的生成记录:",e),Array.isArray(e)?R.value=e:e&&e.success&&Array.isArray(e.data)?R.value=e.data:(R.value=[],e&&(e.message||e.error)&&s.nk.error(e.message||e.error)),0===R.value.length?console.log("没有找到生成记录"):console.log(`成功获取到${R.value.length}条生成记录`)}catch(e){console.error("获取生成记录失败:",e),s.nk.error("获取生成记录失败"),R.value=[]}finally{w.value=!1,console.log("生成记录获取完成")}},G=async e=>{const t=e||$;w.value=!0;try{const e=await(0,i.aR)(t);e&&e.success&&(W.value=e.data);const a=await(0,c.Yz)(t);Array.isArray(a)?R.value=a:a&&a.success&&Array.isArray(a.data)?R.value=a.data:R.value=[]}catch(a){console.error("获取数据失败:",a),s.nk.error("获取数据失败")}finally{w.value=!1}return{success:!0}},q=async()=>{if(0!==R.value.length){I.value=!0;try{console.log("开始导出事件图文本，事件图ID:",$);const e=await(0,c.PH)($);let t=`${W.value?.title||"事件图"}_文本集_${(new Date).toISOString().slice(0,10)}.zip`;const a=new Blob([e],{type:"application/zip"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),s.nk.success("导出成功")}catch(e){console.error("导出文本失败:",e),console.log("尽管有错误提示，但文件可能已成功下载")}finally{I.value=!1}}else s.nk.warning("暂无文本可导出")},B=e=>{t.push({path:`/text-generation/detail/${e}`,query:{from:"records",graphId:$}})},O=()=>{t.push(`/text-generation/create?eventGraphId=${$}`)},P=async e=>{try{await u.s.confirm("确定要删除该文本吗？该操作不可恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});try{await(0,c.gL)(e),s.nk.success("删除成功"),await U()}catch(t){console.error("删除失败:",t),s.nk.error(t?.message||"删除失败")}}catch(a){"cancel"!==a&&console.error("删除操作被取消或出错:",a)}};return(0,n.sV)((async()=>{console.log("生成记录页面加载，事件图ID:",$),await K(),await G()})),(e,t)=>{const a=(0,n.g2)("el-button"),o=(0,n.g2)("el-icon"),s=(0,n.g2)("el-empty"),u=(0,n.g2)("el-tag"),c=(0,n.g2)("el-card"),i=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",v,[(0,n.Lk)("div",p,[(0,n.Lk)("div",null,[(0,n.Lk)("h2",null,"文本生成记录："+(0,r.v_)(W.value?.title||"加载中..."),1),W.value?((0,n.uX)(),(0,n.CE)("div",g,(0,r.v_)(W.value.description),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",y,[(0,n.bF)(a,{type:"success",onClick:q,size:"small",loading:I.value},{default:(0,n.k6)((()=>t[2]||(t[2]=[(0,n.eW)("全部导出")]))),_:1},8,["loading"]),(0,n.bF)(a,{type:"primary",onClick:O,size:"small"},{default:(0,n.k6)((()=>t[3]||(t[3]=[(0,n.eW)("生成新文本")]))),_:1})])]),(0,n.Lk)("div",k,[(0,n.Lk)("div",{class:(0,r.C4)(["nav-button left-button",{disabled:!E.value}]),onClick:t[0]||(t[0]=e=>T("prev"))},[(0,n.bF)(o,null,{default:(0,n.k6)((()=>[((0,n.uX)(),(0,n.Wv)((0,n.$y)((0,l.R1)(d.nkM))))])),_:1})],2),(0,n.bo)(((0,n.uX)(),(0,n.CE)("div",f,[0===R.value.length?((0,n.uX)(),(0,n.Wv)(s,{key:0,description:"暂无生成记录"})):((0,n.uX)(),(0,n.CE)("div",h,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(R.value,(e=>((0,n.uX)(),(0,n.Wv)(c,{key:e.id,class:"text-card"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",m,[(0,n.Lk)("h3",null,"文本ID: "+(0,r.v_)(e.id),1),(0,n.Lk)("div",_,[(0,n.Lk)("div",b,[e.style?((0,n.uX)(),(0,n.Wv)(u,{key:0,type:"success"},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e.style.name),1)])),_:2},1024)):((0,n.uX)(),(0,n.Wv)(u,{key:1},{default:(0,n.k6)((()=>[(0,n.eW)("风格ID: "+(0,r.v_)(e.styleId),1)])),_:2},1024))]),(0,n.Lk)("span",A,"创建时间: "+(0,r.v_)(F(e.createdAt)),1)])]),(0,n.Lk)("div",x,[(0,n.Lk)("div",C,(0,r.v_)(e.content),1)]),(0,n.Lk)("div",L,[(0,n.bF)(a,{type:"primary",link:"",onClick:t=>B(e.id)},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)("查看详情")]))),_:2},1032,["onClick"]),(0,n.bF)(a,{type:"danger",link:"",onClick:t=>P(e.id)},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)("删除")]))),_:2},1032,["onClick"])])])),_:2},1024)))),128))]))])),[[i,w.value]]),(0,n.Lk)("div",{class:(0,r.C4)(["nav-button right-button",{disabled:!z.value}]),onClick:t[1]||(t[1]=e=>T("next"))},[(0,n.bF)(o,null,{default:(0,n.k6)((()=>[((0,n.uX)(),(0,n.Wv)((0,n.$y)((0,l.R1)(d.Qpb))))])),_:1})],2)])])}}},I=a(1241);const R=(0,I.A)(w,[["__scopeId","data-v-4036e2bb"]]);var W=R},8426:function(e,t,a){a.d(t,{$R:function(){return v},A_:function(){return l},Db:function(){return o},PH:function(){return i},U6:function(){return s},Vy:function(){return r},Xi:function(){return d},Yz:function(){return c},gL:function(){return u},qV:function(){return p}});var n=a(5720);function r(){return(0,n.A)({url:"/api/generated_texts/all",method:"get",params:{_t:(new Date).getTime()},headers:{"Cache-Control":"no-cache, no-store",Pragma:"no-cache"}})}function l(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"get"})}function o(e){return(0,n.A)({url:"/api/generated_texts",method:"post",data:e})}function s(e){return(0,n.A)({url:"/api/generated_texts/latest",method:"get",params:{eventGraphId:e}})}function u(e){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"delete"})}function c(e){return console.log("开始请求事件图生成记录，事件图ID:",e),(0,n.A)({url:"/api/generated_texts",method:"get",params:{eventGraphId:e}})}function i(e){return(0,n.A)({url:"/api/generated_texts/export",method:"get",params:{eventGraphId:e},responseType:"blob"})}function d(){return(0,n.A)({url:"/api/generated_texts/export/all",method:"get",responseType:"blob"})}function v(e){return(0,n.A)({url:`/generated_texts/${e}/status`,method:"get"})}function p(e,t){return(0,n.A)({url:`/api/generated_texts/${e}`,method:"put",data:t})}}}]);